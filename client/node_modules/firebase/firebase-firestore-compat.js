!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(sf,of){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l,t=e(sf);function n(t){const n=[];let r=0;for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++s)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const s=[];for(let u=0;u<n.length;u+=3){var i=n[u],o=u+1<n.length,a=o?n[u+1]:0,h=u+2<n.length,c=h?n[u+2]:0;let e=(15&a)<<2|c>>6,t=63&c;h||(t=64,o||(e=64)),s.push(r[i>>2],r[(3&i)<<4|a>>4],r[e],r[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var s,i,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(s=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&s)):239<o&&o<365?(i=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],i=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&s)<<6|63&i))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let h=0;h<e.length;){var s=n[e.charAt(h++)],i=h<e.length?n[e.charAt(h)]:0;++h;var o=h<e.length?n[e.charAt(h)]:64;++h;var a=h<e.length?n[e.charAt(h)]:64;if(++h,null==s||null==i||null==o||null==a)throw Error();r.push(s<<2|i>>4),64!==o&&(r.push(i<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},o=function(e){return e=e,t=n(e),r.encodeByteArray(t,!0).replace(/\./g,"");var t};function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function s(){return!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class a extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i.prototype.create)}}class i{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],i=i?(r=n,i.replace(h,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",i=`${this.serviceName}: ${i} (${s}).`;return new a(s,i,n)}}const h=/\{\$([^}]+)}/g;function m(e){return e&&e._delegate?e._delegate:e}class c{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(cl=l=l||{})[cl.DEBUG=0]="DEBUG",cl[cl.VERBOSE=1]="VERBOSE",cl[cl.INFO=2]="INFO",cl[cl.WARN=3]="WARN",cl[cl.ERROR=4]="ERROR",cl[cl.SILENT=5]="SILENT";const u={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},d=l.INFO,g={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},p=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),s=g[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)}};var y,v="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w={},b=v||self;function T(){}function E(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function I(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var _="closure_uid_"+(1e9*Math.random()>>>0),S=0;function A(e,t,n){return e.call.apply(e.bind,arguments)}function D(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function C(e,t,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:D).apply(null,arguments)}function N(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function k(e,i){function t(){}t.prototype=i.prototype,e.Z=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[t].apply(e,r)}}function x(){this.s=this.s,this.o=this.o}var R={};x.prototype.s=!1,x.prototype.na=function(){var e,t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,e=Object.prototype.hasOwnProperty.call(t,_)&&t[_]||(t[_]=++S),delete R[e])},x.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const L=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},O=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){var r=e.length,s="string"==typeof e?e.split(""):e;for(let i=0;i<r;i++)i in s&&t.call(n,s[i],i,e)};function M(){return Array.prototype.concat.apply([],arguments)}function P(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function F(e){return/^[\s\xa0]*$/.test(e)}var V,q=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function U(e,t){return-1!=e.indexOf(t)}function B(e,t){return e<t?-1:t<e?1:0}e:{var j=b.navigator;if(j){j=j.userAgent;if(j){V=j;break e}}V=""}function K(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function $(e){const t={};for(const n in e)t[n]=e[n];return t}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s])t[n]=r[n];for(let e=0;e<G.length;e++)n=G[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function W(e){return W[" "](e),e}W[" "]=T;var H,Q=U(V,"Opera"),Y=U(V,"Trident")||U(V,"MSIE"),X=U(V,"Edge"),J=X||Y,Z=U(V,"Gecko")&&!(U(V.toLowerCase(),"webkit")&&!U(V,"Edge"))&&!(U(V,"Trident")||U(V,"MSIE"))&&!U(V,"Edge"),ee=U(V.toLowerCase(),"webkit")&&!U(V,"Edge");function te(){var e=b.document;return e?e.documentMode:void 0}e:{var ne="",re=(re=V,Z?/rv:([^\);]+)(\)|;)/.exec(re):X?/Edge\/([\d\.]+)/.exec(re):Y?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(re):ee?/WebKit\/(\S+)/.exec(re):Q?/(?:Version)[ \/]?(\S+)/.exec(re):void 0);if(re&&(ne=re?re[1]:""),Y){re=te();if(null!=re&&re>parseFloat(ne)){H=String(re);break e}}H=ne}var se={};function ie(){return e=function(){let e=0;var t=q(String(H)).split("."),n=q("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++)for(var s=t[o]||"",i=n[o]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],(0!=s[0].length||0!=i[0].length)&&(e=B(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||B(0==s[2].length,0==i[2].length)||B(s[2],i[2]),s=s[3],i=i[3],0==e););return 0<=e},t=se,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var oe=b.document&&Y&&(te()||parseInt(H,10))||void 0,ae=function(){if(!b.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{b.addEventListener("test",T,t),b.removeEventListener("test",T,t)}catch(e){}return e}();function he(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function ce(e,t){if(he.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Z){e:{try{W(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ue[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&ce.Z.h.call(this)}}he.prototype.h=function(){this.defaultPrevented=!0},k(ce,he);var ue={2:"touch",3:"pen",4:"mouse"};ce.prototype.h=function(){ce.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var le="closure_listenable_"+(1e6*Math.random()|0),de=0;function fe(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=s,this.key=++de,this.ca=this.fa=!1}function ge(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function me(e){this.src=e,this.g={},this.h=0}function pe(e,t){var n,r,s,i=t.type;i in e.g&&(n=e.g[i],(s=0<=(r=L(n,t)))&&Array.prototype.splice.call(n,r,1),s&&(ge(t),0==e.g[i].length&&(delete e.g[i],e.h--)))}function ye(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ca&&i.listener==t&&i.capture==!!n&&i.ia==r)return s}return-1}me.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=ye(e,t,r,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new fe(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var ve="closure_lm_"+(1e6*Math.random()|0),we={};function be(e,t,n,r,s){if(r&&r.once)return function e(t,n,r,s,i){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);return null}r=De(r);return t&&t[le]?t.O(n,r,I(s)?!!s.capture:!!s,i):Te(t,n,r,!0,s,i)}(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)be(e,t[i],n,r,s);return null}return n=De(n),e&&e[le]?e.N(t,n,I(r)?!!r.capture:!!r,s):Te(e,t,n,!1,r,s)}function Te(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o,a=I(s)?!!s.capture:!!s,h=Se(e);if(h||(e[ve]=h=new me(e)),(n=h.add(t,n,r,a,i)).proxy)return n;if(o=_e,r=function e(t){return o.call(e.src,e.listener,t)},(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(s=!ae?a:s)&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(Ie(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ee(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[le]?pe(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ie(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Se(t))?(pe(n,e),0==n.h&&(n.src=null,t[ve]=null)):ge(e)))}function Ie(e){return e in we?we[e]:we[e]="on"+e}function _e(e,t){var n,r;return e=!!e.ca||(t=new ce(t,this),n=e.listener,r=e.ia||e.src,e.fa&&Ee(e),n.call(r,t))}function Se(e){return(e=e[ve])instanceof me?e:null}var Ae="__closure_events_fn_"+(1e9*Math.random()>>>0);function De(t){return"function"==typeof t?t:(t[Ae]||(t[Ae]=function(e){return t.handleEvent(e)}),t[Ae])}function Ce(){x.call(this),this.i=new me(this),(this.P=this).I=null}function Ne(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new he(t,e):t instanceof he?t.target=t.target||e:(o=t,z(t=new he(r,e),o)),o=!0,n)for(var s=n.length-1;0<=s;s--)var i=t.g=n[s],o=ke(i,r,!0,t)&&o;if(o=ke(i=t.g=e,r,!0,t)&&o,o=ke(i,r,!1,t)&&o,n)for(s=0;s<n.length;s++)o=ke(i=t.g=n[s],r,!1,t)&&o}function ke(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o,a,h=t[i];h&&!h.ca&&h.capture==n&&(o=h.listener,a=h.ia||h.src,h.fa&&pe(e.i,h),s=!1!==o.call(a,r)&&s)}return s&&!r.defaultPrevented}k(Ce,x),Ce.prototype[le]=!0,Ce.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,s,i){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);else s=I(s)?!!s.capture:!!s,r=De(r),t&&t[le]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ye(o=t.g[n],r,s,i))&&(ge(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&Se(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?ye(n,r,s,i):t)?n[t]:null)&&Ee(r))}(this,e,t,n,r)},Ce.prototype.M=function(){if(Ce.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ge(n[r]);delete t.g[e],t.h--}}this.I=null},Ce.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ce.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var xe=b.JSON.stringify;var Re,Le=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Oe,e=>e.reset());class Oe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Me(e,t){var n;Re||(n=b.Promise.resolve(void 0),Re=function(){n.then(Ve)}),Pe||(Re(),Pe=!0),Fe.add(e,t)}var Pe=!1,Fe=new class{constructor(){this.h=this.g=null}add(e,t){const n=Le.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Ve(){for(var e;e=function(){var e=Fe;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){b.setTimeout(()=>{throw e},0)}(e)}var t=Le;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Pe=!1}function qe(e,t){Ce.call(this),this.h=e||1,this.g=t||b,this.j=C(this.kb,this),this.l=Date.now()}function Ue(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Be(e,t,n){if("function"==typeof e)n&&(e=C(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=C(e.handleEvent,e)}return 2147483647<Number(t)?-1:b.setTimeout(e,t||0)}k(qe,Ce),(y=qe.prototype).da=!1,y.S=null,y.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ne(this,"tick"),this.da&&(Ue(this),this.start())))},y.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},y.M=function(){qe.Z.M.call(this),Ue(this),delete this.g};class je extends x{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Be(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(b.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ke(e){x.call(this),this.h=e,this.g={}}k(Ke,x);var $e=[];function Ge(e,t,n,r){Array.isArray(n)||(n&&($e[0]=n.toString()),n=$e);for(var s=0;s<n.length;s++){var i=be(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function ze(e){K(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ee(e)},e),e.g={}}function We(){this.g=!0}function He(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return xe(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Ke.prototype.M=function(){Ke.Z.M.call(this),ze(this)},Ke.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Aa=function(){this.g=!1},We.prototype.info=function(){};var Qe={},Ye=null;function Xe(){return Ye=Ye||new Ce}function Je(e){he.call(this,Qe.Ma,e)}function Ze(){var e=Xe();Ne(e,new Je(e))}function et(e,t){he.call(this,Qe.STAT_EVENT,e),this.stat=t}function tt(e){var t=Xe();Ne(t,new et(t,e))}function nt(e,t){he.call(this,Qe.Na,e),this.size=t}function rt(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return b.setTimeout(function(){e()},t)}Qe.Ma="serverreachability",k(Je,he),Qe.STAT_EVENT="statevent",k(et,he),Qe.Na="timingevent",k(nt,he);var st={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},it={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ot(){}function at(e){return e.h||(e.h=e.i())}function ht(){}ot.prototype.h=null;v={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ct(){he.call(this,"d")}function ut(){he.call(this,"c")}function lt(){}function dt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Ke(this),this.P=mt,this.W=new qe(e=J?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ft}function ft(){this.i=null,this.g="",this.h=!1}k(ct,he),k(ut,he),k(lt,ot),lt.prototype.g=function(){return new XMLHttpRequest},lt.prototype.i=function(){return{}};var gt=new lt,mt=45e3,pt={},yt={};function vt(e,t,n){e.K=1,e.v=Ut(Ot(t)),e.s=n,e.U=!0,wt(e,null)}function wt(e,t){e.F=Date.now(),Et(e),e.A=Ot(e.v);var o,a,h,c,u,l,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Zt(n.h,"t",r),e.C=0,n=e.l.H,e.h=new ft,e.g=er(e.l,n?t:null,!e.s),0<e.O&&(e.L=new je(C(e.Ia,e,e.g),e.O)),Ge(e.V,e.g,"readystatechange",e.gb),t=e.H?$(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ze(),o=e.j,a=e.u,h=e.A,c=e.m,u=e.X,l=e.s,o.info(function(){if(o.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,s,i=t[n].split("=");1<i.length&&(r=i[0],i=i[1],e=2<=(s=r.split("_")).length&&"type"==s[1]?e+(r+"=")+i+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+c+") [attempt "+u+"]: "+a+"\n"+h+"\n"+e})}function bt(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Tt(e,t,n){let r=!0,s;for(;!e.I&&e.C<n.length;){if(s=(o=n,h=a=void 0,a=(i=e).C,-1==(h=o.indexOf("\n",a))?yt:(a=Number(o.substring(a,h)),isNaN(a)?pt:(h+=1)+a>o.length?yt:(o=o.substr(h,a),i.C=h+a,o))),s==yt){4==t&&(e.o=4,tt(14),r=!1),He(e.j,e.m,null,"[Incomplete Response]");break}if(s==pt){e.o=4,tt(15),He(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}He(e.j,e.m,s,null),Dt(e,s)}var i,o,a,h;bt(e)&&s!=yt&&s!=pt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,tt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),zn(t),t.L=!0,tt(11))):(He(e.j,e.m,n,"[Invalid Chunked Response]"),At(e),St(e))}function Et(e){e.Y=Date.now()+e.P,It(e,e.P)}function It(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=rt(C(e.eb,e),t)}function _t(e){e.B&&(b.clearTimeout(e.B),e.B=null)}function St(e){0==e.l.G||e.I||Qn(e.l,e)}function At(e){_t(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ue(e.W),ze(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Dt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||an(n.i,e)))if(n.I=e.N,!e.J&&an(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Hn(n),Fn(n)}Gn(n),tt(18)}}else n.ta=s[1],0<n.ta-n.U&&s[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=rt(C(n.ab,n),6e3));if(on(n.i)<=1&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else Xn(n,11)}else if(!e.J&&n.g!=e||Hn(n),!F(t))for(s=n.Ca.g.parse(t),t=0;t<s.length;t++){var i=s[t];if(n.U=i[0],i=i[1],2==n.G)if("c"==i[0]){n.J=i[1],n.la=i[2];var o=i[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=i[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var h,c,u,l=i[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const m=e.g;m&&(!(h=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(c=r.i).g&&(U(h,"spdy")||U(h,"quic")||U(h,"h2"))&&(c.j=c.l,c.g=new Set,c.h&&(hn(c,c.h),c.h=null)),!r.D||(u=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=u,qt(r.F,r.D,u))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d,f,g=e;(r=n).oa=Zn(r,r.H?r.la:null,r.W),g.J?(cn(r.i,g),d=g,(f=r.K)&&d.setTimeout(f),d.B&&(_t(d),Et(d)),r.g=g):$n(r),0<n.l.length&&Un(n)}else"stop"!=i[0]&&"close"!=i[0]||Xn(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Xn(n,7):Pn(n):"noop"!=i[0]&&n.j&&n.j.wa(i),n.A=0)}Ze()}catch(e){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(E(e)||"string"==typeof e)O(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(E(e)||"string"==typeof e)for(var n=[],r=e.length,s=0;s<r;s++)n.push(s);else for(s in n=[],r=0,e)n[r++]=s;for(var s=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(E(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}}function Nt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Nt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function kt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];xt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var s={},n=t=0;t<e.g.length;)xt(s,r=e.g[t])||(s[e.g[n++]=r]=1),t++;e.g.length=n}}function xt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(y=dt.prototype).setTimeout=function(e){this.P=e},y.gb=function(e){e=e.target;const t=this.L;t&&3==xn(e)?t.l():this.Ia(e)},y.Ia=function(e){try{if(e==this.g)e:{var t=xn(this.g),n=this.g.Da();this.g.ba();if(!(t<3)&&(3!=t||J||this.g&&(this.h.h||this.g.ga()||Rn(this.g)))){this.I||4!=t||7==n||Ze(),_t(this);var r=this.g.ba();this.N=r;t:if(bt(this)){var s=Rn(this.g);e="";var i=s.length,o=4==xn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){At(this),St(this);var a="";break t}this.h.i=new b.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:o&&n==i-1});s.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.X,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var h,c=this.g;if((h=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(h)){var u=h;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,tt(12),At(this),St(this);break e}He(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Dt(this,r)}this.U?(Tt(this,t,a),J&&this.i&&3==t&&(Ge(this.V,this.W,"tick",this.fb),this.W.start())):(He(this.j,this.m,a,null),Dt(this,a)),4==t&&At(this),this.i&&!this.I&&(4==t?Qn(this.l,this):(this.i=!1,Et(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,tt(12)):(this.o=0,tt(13)),At(this),St(this)}}}catch(e){}var l,d,f,g,m,p,y},y.fb=function(){var e,t;this.g&&(e=xn(this.g),t=this.g.ga(),this.C<t.length&&(_t(this),Tt(this,e,t),this.i&&4!=e&&Et(this)))},y.cancel=function(){this.I=!0,At(this)},y.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(Ze(),tt(17)),At(this),this.o=2,St(this)):It(this,this.Y-n)},(y=Nt.prototype).R=function(){kt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},y.T=function(){return kt(this),this.g.concat()},y.get=function(e,t){return xt(this.h,e)?this.h[e]:t},y.set=function(e,t){xt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},y.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);e.call(t,i,s,this)}};var Rt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Lt(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Lt?(this.g=void 0!==t?t:e.g,Mt(this,e.j),this.s=e.s,Pt(this,e.i),Ft(this,e.m),this.l=e.l,t=e.h,(n=new Qt).i=t.i,t.g&&(n.g=new Nt(t.g),n.h=t.h),Vt(this,n),this.o=e.o):e&&(n=String(e).match(Rt))?(this.g=!!t,Mt(this,n[1]||"",!0),this.s=Bt(n[2]||""),Pt(this,n[3]||"",!0),Ft(this,n[4]),this.l=Bt(n[5]||"",!0),Vt(this,n[6]||"",!0),this.o=Bt(n[7]||"")):(this.g=!!t,this.h=new Qt(null,this.g))}function Ot(e){return new Lt(e)}function Mt(e,t,n){e.j=n?Bt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Pt(e,t,n){e.i=n?Bt(t,!0):t}function Ft(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Vt(e,t,n){var r,s;t instanceof Qt?(e.h=t,r=e.h,(s=e.g)&&!r.j&&(Yt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Xt(this,t),Zt(this,n,e))},r)),r.j=s):(n||(t=jt(t,Wt)),e.h=new Qt(t,e.g))}function qt(e,t,n){e.h.set(t,n)}function Ut(e){return qt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Bt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function jt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Kt),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Kt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Lt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(jt(t,$t,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(jt(t,$t,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(jt(n,"/"==n.charAt(0)?zt:Gt,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",jt(n,Ht)),e.join("")};var $t=/[#\/\?@]/g,Gt=/[#\?:]/g,zt=/[#\?]/g,Wt=/[#\?@]/g,Ht=/#/g;function Qt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Yt(n){n.g||(n.g=new Nt,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,s=e[n].indexOf("="),i=null;0<=s?(r=e[n].substring(0,s),i=e[n].substring(s+1)):r=e[n],t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Xt(e,t){Yt(e),t=en(e,t),xt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,xt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&kt(e)))}function Jt(e,t){return Yt(e),t=en(e,t),xt(e.g.h,t)}function Zt(e,t,n){Xt(e,t),0<n.length&&(e.i=null,e.g.set(en(e,t),P(n)),e.h+=n.length)}function en(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(y=Qt.prototype).add=function(e,t){Yt(this),this.i=null,e=en(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},y.forEach=function(n,r){Yt(this),this.g.forEach(function(e,t){O(e,function(e){n.call(r,e,t,this)},this)},this)},y.T=function(){Yt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var s=e[r],i=0;i<s.length;i++)n.push(t[r]);return n},y.R=function(e){Yt(this);var t=[];if("string"==typeof e)Jt(this,e)&&(t=M(t,this.g.get(en(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=M(t,e[n])}return t},y.set=function(e,t){return Yt(this),this.i=null,Jt(this,e=en(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},y.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},y.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],s=encodeURIComponent(String(r)),r=this.R(r),i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),e.push(o)}return this.i=e.join("&")};var tn=class{constructor(e,t){this.h=e,this.g=t}};function nn(e){this.l=e||10,e=b.PerformanceNavigationTiming?0<(e=b.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(b.g&&b.g.Ea&&b.g.Ea()&&b.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var rn;function sn(e){return e.h||e.g&&e.g.size>=e.j}function on(e){return e.h?1:e.g?e.g.size:0}function an(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function hn(e,t){e.g?e.g.add(t):e.h=t}function cn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function un(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return P(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function ln(){}function dn(){this.g=new ln}function fn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function gn(e){this.l=e.$b||null,this.j=e.ib||!1}function mn(e,t){Ce.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=pn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}nn.prototype.cancel=function(){if(this.i=un(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},ln.prototype.stringify=function(e){return b.JSON.stringify(e,void 0)},ln.prototype.parse=function(e){return b.JSON.parse(e,void 0)},k(gn,ot),gn.prototype.g=function(){return new mn(this.l,this.j)},gn.prototype.i=(rn={},function(){return rn}),k(mn,Ce);var pn=0;function yn(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function vn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,wn(e)}function wn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(y=mn.prototype).open=function(e,t){if(this.readyState!=pn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,wn(this)},y.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||b).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,vn(this)),this.readyState=pn},y.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,wn(this)),this.g&&(this.readyState=3,wn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==b.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;yn(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},y.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?vn:wn)(this),3==this.readyState&&yn(this))},y.Ua=function(e){this.g&&(this.response=this.responseText=e,vn(this))},y.Ta=function(e){this.g&&(this.response=e,vn(this))},y.ha=function(){this.g&&vn(this)},y.setRequestHeader=function(e,t){this.v.append(e,t)},y.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},y.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(mn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var bn=b.JSON.parse;function Tn(e){Ce.call(this),this.headers=new Nt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=En,this.K=this.L=!1}k(Tn,Ce);var En="",In=/^https?$/i,_n=["POST","PUT"];function Sn(e){return"content-type"==e.toLowerCase()}function An(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Dn(e),Nn(e)}function Dn(e){e.D||(e.D=!0,Ne(e,"complete"),Ne(e,"error"))}function Cn(e){if(e.h&&void 0!==w&&(!e.C[1]||4!=xn(e)||2!=e.ba()))if(e.v&&4==xn(e))Be(e.Fa,0,e);else if(Ne(e,"readystatechange"),4==xn(e)){e.h=!1;try{var t,n,r,s,i=e.ba();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===i)&&(!(s=String(e.H).match(Rt)[1]||null)&&b.self&&b.self.location&&(s=(r=b.self.location.protocol).substr(0,r.length-1)),n=!In.test(s?s.toLowerCase():"")),t=n),t)Ne(e,"complete"),Ne(e,"success");else{e.m=6;try{var a=2<xn(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",Dn(e)}}finally{Nn(e)}}}function Nn(e,t){if(e.g){kn(e);const n=e.g,r=e.C[0]?T:null;e.g=null,e.C=null,t||Ne(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function kn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(b.clearTimeout(e.A),e.A=null)}function xn(e){return e.g?e.g.readyState:0}function Rn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case En:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ln(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let n="";return K(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):qt(e,t,n))}function On(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Mn(e){this.za=0,this.l=[],this.h=new We,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=On("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=On("baseRetryDelayMs",5e3,e),this.$a=On("retryDelaySeedMs",1e4,e),this.Ya=On("forwardChannelMaxRetries",2,e),this.ra=On("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new nn(e&&e.concurrentRequestLimit),this.Ca=new dn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Pn(e){var t,n;Vn(e),3==e.G&&(t=e.V++,qt(n=Ot(e.F),"SID",e.J),qt(n,"RID",t),qt(n,"TYPE","terminate"),jn(e,n),(t=new dt(e,e.h,t,void 0)).K=2,t.v=Ut(Ot(n)),n=!1,!(n=b.navigator&&b.navigator.sendBeacon?b.navigator.sendBeacon(t.v.toString(),""):n)&&b.Image&&((new Image).src=t.v,n=!0),n||(t.g=er(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Et(t)),Jn(e)}function Fn(e){e.g&&(zn(e),e.g.cancel(),e.g=null)}function Vn(e){Fn(e),e.u&&(b.clearTimeout(e.u),e.u=null),Hn(e),e.i.cancel(),e.m&&("number"==typeof e.m&&b.clearTimeout(e.m),e.m=null)}function qn(e,t){e.l.push(new tn(e.Za++,t)),3==e.G&&Un(e)}function Un(e){sn(e.i)||e.m||(e.m=!0,Me(e.Ha,e),e.C=0)}function Bn(e,t){var n=t?t.m:e.V++,r=Ot(e.F);qt(r,"SID",e.J),qt(r,"RID",n),qt(r,"AID",e.U),jn(e,r),e.o&&e.s&&Ln(r,e.o,e.s),n=new dt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Kn(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),hn(e.i,n),vt(n,r,t)}function jn(e,n){e.j&&Ct({},function(e,t){qt(n,t,e)})}function Kn(e,t,r){r=Math.min(e.l.length,r);var s=e.j?C(e.j.Oa,e.j,e):null;e:{var i=e.l;let n=-1;for(;;){const h=["count="+r];-1==n?0<r?(n=i[0].h,h.push("ofs="+n)):n=0:h.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var o=i[t].h,a=i[t].g;if((o-=n)<0)n=Math.max(0,i[t].h-100),e=!1;else try{!function(e,r,t){const s=t||"";try{Ct(e,function(e,t){let n=e;I(e)&&(n=xe(e)),r.push(s+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(s+"type="+encodeURIComponent("_badmap")),e}}(a,h,"req"+o+"_")}catch(e){s&&s(a)}}if(e){s=h.join("&");break e}}}return e=e.l.splice(0,r),t.D=e,s}function $n(e){e.g||e.u||(e.Y=1,Me(e.Ga,e),e.A=0)}function Gn(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=rt(C(e.Ga,e),Yn(e,e.A)),e.A++,1)}function zn(e){null!=e.B&&(b.clearTimeout(e.B),e.B=null)}function Wn(e){e.g=new dt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Ot(e.oa);qt(t,"RID","rpc"),qt(t,"SID",e.J),qt(t,"CI",e.N?"0":"1"),qt(t,"AID",e.U),jn(e,t),qt(t,"TYPE","xmlhttp"),e.o&&e.s&&Ln(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Ut(Ot(t)),n.s=null,n.U=!0,wt(n,e)}function Hn(e){null!=e.v&&(b.clearTimeout(e.v),e.v=null)}function Qn(e,t){var n,r,s,i=null;if(e.g==t){Hn(e),zn(e),e.g=null;var o=2}else{if(!an(e.i,t))return;i=t.D,cn(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(i=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Ne(o=Xe(),new nt(o,i)),Un(e)):$n(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(s=t,on((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=s.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=rt(C(r.Ha,r,s),Yn(r,r.C)),r.C++,0))))&&(2!=o||!Gn(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),n){case 1:Xn(e,5);break;case 4:Xn(e,10);break;case 3:Xn(e,6);break;default:Xn(e,2)}}function Yn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function Xn(e,t){var n,r;e.h.info("Error code "+t),2==t?(n=null,e.j&&(n=null),r=C(e.jb,e),n||(n=new Lt("//www.google.com/images/cleardot.gif"),b.location&&"http"==b.location.protocol||Mt(n,"https"),Ut(n)),function(e,t){var n=new We;if(b.Image){const r=new Image;r.onload=N(fn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=N(fn,n,r,"TestLoadImage: error",!1,t),r.onabort=N(fn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=N(fn,n,r,"TestLoadImage: timeout",!1,t),b.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):tt(2),e.G=0,e.j&&e.j.va(t),Jn(e),Vn(e)}function Jn(e){e.G=0,e.I=-1,e.j&&(0==un(e.i).length&&0==e.l.length||(e.i.i.length=0,P(e.l),e.l.length=0),e.j.ua())}function Zn(e,t,n){let r=(a=n)instanceof Lt?Ot(a):new Lt(a,void 0);var s,i,o,a,h;return""!=r.i?(t&&Pt(r,t+"."+r.i),Ft(r,r.m)):(h=b.location,r=(s=h.protocol,i=t?t+"."+h.hostname:h.hostname,o=+h.port,a=n,h=new Lt(null,void 0),s&&Mt(h,s),i&&Pt(h,i),o&&Ft(h,o),a&&(h.l=a),h)),e.aa&&K(e.aa,function(e,t){qt(r,t,e)}),t=e.D,n=e.sa,t&&n&&qt(r,t,n),qt(r,"VER",e.ma),jn(e,r),r}function er(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Tn(new gn({ib:!0})):new Tn(e.qa)).L=e.H,t}function tr(){}function nr(){if(Y&&!(10<=Number(oe)))throw Error("Environmental error: no available transport.")}function rr(e,t){Ce.call(this),this.g=new Mn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!F(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!F(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new or(this)}function sr(e){ct.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ir(){ut.call(this),this.status=1}function or(e){this.g=e}(y=Tn.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||gt).g(),this.C=this.u?at(this.u):at(gt),this.g.onreadystatechange=C(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void An(this,e)}e=n||"";const s=new Nt(this.headers);r&&Ct(r,function(e,t){s.set(t,e)}),r=function(t){e:{var n=Sn,r=t.length,s="string"==typeof t?t.split(""):t;for(let e=0;e<r;e++)if(e in s&&n.call(void 0,s[e],e,t)){n=e;break e}n=-1}return n<0?null:"string"==typeof t?t.charAt(n):t[n]}(s.T()),n=b.FormData&&e instanceof b.FormData,0<=L(_n,t)&&!r&&!n&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{kn(this),0<this.B&&((this.K=(i=this.g,Y&&ie()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=C(this.pa,this)):this.A=Be(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){An(this,e)}var i},y.pa=function(){void 0!==w&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ne(this,"timeout"),this.abort(8))},y.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ne(this,"complete"),Ne(this,"abort"),Nn(this))},y.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nn(this,!0)),Tn.Z.M.call(this)},y.Fa=function(){this.s||(this.F||this.v||this.l?Cn(this):this.cb())},y.cb=function(){Cn(this)},y.ba=function(){try{return 2<xn(this)?this.g.status:-1}catch(e){return-1}},y.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},y.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),bn(t)}},y.Da=function(){return this.m},y.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(y=Mn.prototype).ma=8,y.G=1,y.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},y.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new dt(this,this.h,t,void 0);let e=this.s;if(this.P&&(e?(e=$(e),z(e,this.P)):e=this.P),null===this.o&&(i.H=e),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var s=this.l[r];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(n+=s)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Kn(this,i,n),qt(r=Ot(this.F),"RID",t),qt(r,"CVER",22),this.D&&qt(r,"X-HTTP-Session-Id",this.D),jn(this,r),this.o&&e&&Ln(r,this.o,e),hn(this.i,i),this.Ra&&qt(r,"TYPE","init"),this.ja?(qt(r,"$req",n),qt(r,"SID","null"),i.$=!0,vt(i,r,null)):vt(i,r,n),this.G=2}}else 3==this.G&&(t?Bn(this,t):0==this.l.length||sn(this.i)||Bn(this))},y.Ga=function(){var e;this.u=null,Wn(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=rt(C(this.bb,this),e))},y.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,tt(10),Fn(this),Wn(this))},y.ab=function(){null!=this.v&&(this.v=null,Fn(this),Gn(this),tt(19))},y.jb=function(e){e?(this.h.info("Successfully pinged google.com"),tt(2)):(this.h.info("Failed to ping google.com"),tt(1))},(y=tr.prototype).xa=function(){},y.wa=function(){},y.va=function(){},y.ua=function(){},y.Oa=function(){},nr.prototype.g=function(e,t){return new rr(e,t)},k(rr,Ce),rr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Me(C(e.hb,e,t))),tt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=Zn(e,null,e.W),Un(e)},rr.prototype.close=function(){Pn(this.g)},rr.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,qn(this.g,t)):this.v?((t={}).__data__=xe(e),qn(this.g,t)):qn(this.g,e)},rr.prototype.M=function(){this.g.j=null,delete this.j,Pn(this.g),delete this.g,rr.Z.M.call(this)},k(sr,ct),k(ir,ut),k(or,tr),or.prototype.xa=function(){Ne(this.g,"a")},or.prototype.wa=function(e){Ne(this.g,new sr(e))},or.prototype.va=function(e){Ne(this.g,new ir)},or.prototype.ua=function(){Ne(this.g,"b")},nr.prototype.createWebChannel=nr.prototype.g,rr.prototype.send=rr.prototype.u,rr.prototype.open=rr.prototype.m,st.NO_ERROR=0,st.TIMEOUT=8,st.HTTP_ERROR=6,it.COMPLETE="complete",(ht.EventType=v).OPEN="a",v.CLOSE="b",v.ERROR="c",v.MESSAGE="d",Ce.prototype.listen=Ce.prototype.N,Tn.prototype.listenOnce=Tn.prototype.O,Tn.prototype.getLastError=Tn.prototype.La,Tn.prototype.getLastErrorCode=Tn.prototype.Da,Tn.prototype.getStatus=Tn.prototype.ba,Tn.prototype.getResponseJson=Tn.prototype.Qa,Tn.prototype.getResponseText=Tn.prototype.ga,Tn.prototype.send=Tn.prototype.ea;var ar,hr=Xe,cr=st,ur=it,lr=Qe,dr=10,fr=11,gr=gn,mr=ht,pr=Tn;const yr="@firebase/firestore";class vr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}vr.UNAUTHENTICATED=new vr(null),vr.GOOGLE_CREDENTIALS=new vr("google-credentials-uid"),vr.FIRST_PARTY=new vr("first-party-uid"),vr.MOCK_USER=new vr("mock-user");let wr="9.6.6";const br=new class{constructor(e){this.name=e,this._logLevel=d,this._logHandler=p,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?u[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function Tr(){return br.logLevel}function Er(e,...t){var n;br.logLevel<=l.DEBUG&&(n=t.map(Sr),br.debug(`Firestore (${wr}): ${e}`,...n))}function Ir(e,...t){var n;br.logLevel<=l.ERROR&&(n=t.map(Sr),br.error(`Firestore (${wr}): ${e}`,...n))}function _r(e,...t){var n;br.logLevel<=l.WARN&&(n=t.map(Sr),br.warn(`Firestore (${wr}): ${e}`,...n))}function Sr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Ar(e="Unexpected state"){var t=`FIRESTORE (${wr}) INTERNAL ASSERTION FAILED: `+e;throw Ir(t),new Error(t)}function Dr(e){e||Ar()}const Cr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Nr extends a{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class kr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class xr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Rr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(vr.UNAUTHENTICATED))}shutdown(){}}class Lr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Or{constructor(e){this.t=e,this.currentUser=vr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const s=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let i=new kr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new kr,t.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},a=e=>{Er("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(Er("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new kr))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(Er("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Dr("string"==typeof e.accessToken),new xr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return Dr(null===e||"string"==typeof e),new vr(e)}}class Mr{constructor(e,t,n){this.type="FirstParty",this.user=vr.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);var r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Pr{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Mr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(vr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Fr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Vr{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(t,n){this.o=e=>{t.enqueueRetryable(()=>(e=>(null!=e.error&&Er("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),n(e.token)))(e))};const r=e=>{Er("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>r(e)),setTimeout(()=>{var e;this.appCheck||((e=this.g.getImmediate({optional:!0}))?r(e):Er("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Dr("string"==typeof e.token),new Fr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class qr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.T&&this.T(e),e}}qr.I=-1;class Ur{static A(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var s=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<s.length;++e)r.length<20&&s[e]<n&&(r+=t.charAt(s[e]%t.length))}return r}}function Br(e,t){return e<t?-1:t<e?1:0}function jr(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Kr(e){return e+"\0"}class $r{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new Nr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new Nr(Cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Nr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new Nr(Cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return $r.fromMillis(Date.now())}static fromDate(e){return $r.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new $r(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Br(this.nanoseconds,e.nanoseconds):Br(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Gr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Gr(e)}static min(){return new Gr(new $r(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function zr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Wr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Hr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Qr{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ar(),void 0===n?n=e.length-t:n>e.length-t&&Ar(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Qr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Qr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),s=t.get(r);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Yr extends Qr{construct(e,t,n){return new Yr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new Yr(t)}static emptyPath(){return new Yr([])}}const Xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Jr extends Qr{construct(e,t,n){return new Jr(e,t,n)}static isValidIdentifier(e){return Xr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!Jr.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Jr(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var s=()=>{if(0===n.length)throw new Nr(Cr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Nr(Cr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Nr(Cr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?i=!i:"."!==t||i?n+=t:s(),r++}if(s(),i)throw new Nr(Cr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Jr(t)}static emptyPath(){return new Jr([])}}class Zr{constructor(e){(this.fields=e).sort(Jr.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return jr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class es{constructor(e){this.binaryString=e}static fromBase64String(e){var t=atob(e);return new es(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new es(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Br(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}es.EMPTY_BYTE_STRING=new es("");const ts=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ns(t){if(Dr(!!t),"string"!=typeof t)return{seconds:rs(t.seconds),nanos:rs(t.nanos)};{let e=0;var n=ts.exec(t);Dr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function rs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ss(e){return"string"==typeof e?es.fromBase64String(e):es.fromUint8Array(e)}function is(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function os(e){var t=ns(e.mapValue.fields.__local_write_time__.timestampValue);return new $r(t.seconds,t.nanos)}class as{constructor(e,t,n,r,s,i,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class hs{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new hs("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof hs&&e.projectId===this.projectId&&e.database===this.database}}function cs(e){return null==e}function us(e){return 0===e&&1/e==-1/0}function ls(e){return"number"==typeof e&&Number.isInteger(e)&&!us(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class ds{constructor(e){this.path=e}static fromPath(e){return new ds(Yr.fromString(e))}static fromName(e){return new ds(Yr.fromString(e).popFirst(5))}static empty(){return new ds(Yr.emptyPath())}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===Yr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Yr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ds(new Yr(e.slice()))}}function fs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?is(e)?4:10:Ar()}function gs(r,s){if(r===s)return!0;var e,t,n=fs(r);if(n!==fs(s))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===s.booleanValue;case 4:return os(r).isEqual(os(s));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=ns(r.timestampValue),n=ns(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(s);case 5:return r.stringValue===s.stringValue;case 6:return t=s,ss(r.bytesValue).isEqual(ss(t.bytesValue));case 7:return r.referenceValue===s.referenceValue;case 8:return e=s,rs((t=r).geoPointValue.latitude)===rs(e.geoPointValue.latitude)&&rs(t.geoPointValue.longitude)===rs(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return rs(e.integerValue)===rs(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=rs(e.doubleValue),r=rs(t.doubleValue);return n===r?us(n)===us(r):isNaN(n)&&isNaN(r)}return!1}(r,s);case 9:return jr(r.arrayValue.values||[],s.arrayValue.values||[],gs);case 10:return function(e){const t=e.mapValue.fields||{},n=s.mapValue.fields||{};if(zr(t)!==zr(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!gs(t[e],n[e])))return!1;return!0}(r);default:return Ar()}}function ms(e,t){return void 0!==(e.values||[]).find(e=>gs(e,t))}function ps(e,t){if(e===t)return 0;var n,r,s,i,o=fs(e),a=fs(t);if(o!==a)return Br(o,a);switch(o){case 0:return 0;case 1:return Br(e.booleanValue,t.booleanValue);case 2:return r=t,s=rs(e.integerValue||e.doubleValue),i=rs(r.integerValue||r.doubleValue),s<i?-1:i<s?1:s===i?0:isNaN(s)?isNaN(i)?0:-1:1;case 3:return ys(e.timestampValue,t.timestampValue);case 4:return ys(os(e),os(t));case 5:return Br(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ss(e),r=ss(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=Br(n[s],r[s]);if(0!==t)return t}return Br(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(i=Br(rs(n.latitude),rs(r.latitude)))?i:Br(rs(n.longitude),rs(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=ps(n[s],r[s]);if(t)return t}return Br(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let a=0;a<r.length&&a<i.length;++a){const t=Br(r[a],i[a]);if(0!==t)return t;var o=ps(n[r[a]],s[i[a]]);if(0!==o)return o}return Br(r.length,i.length)}(e.mapValue,t.mapValue);default:throw Ar()}}function ys(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Br(e,t);var n=ns(e),r=ns(t),s=Br(n.seconds,r.seconds);return 0!==s?s:Br(n.nanos,r.nanos)}function vs(e){return function i(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=ns(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ss(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,ds.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=i(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${i(e.fields[s])}`;return n+"}"}(e.mapValue):Ar();var t}(e)}function ws(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function bs(e){return e&&"integerValue"in e}function Ts(e){return!!e&&"arrayValue"in e}function Es(e){return e&&"nullValue"in e}function Is(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function _s(e){return e&&"mapValue"in e}function Ss(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Wr(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Ss(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Ss(t.arrayValue.values[e]);return r}return Object.assign({},t)}class As{constructor(e){this.value=e}static empty(){return new As({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!_s(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ss(t)}setAll(e){let n=Jr.emptyPath(),r={},s=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,s),r={},s=[],n=t.popLast()}e?r[t.lastSegment()]=Ss(e):s.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,s)}delete(e){const t=this.field(e.popLast());_s(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return gs(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];_s(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){Wr(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new As(Ss(this.value))}}class Ds{constructor(e,t,n,r,s,i){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new Ds(e,0,Gr.min(),Gr.min(),As.empty(),0)}static newFoundDocument(e,t,n){return new Ds(e,1,t,Gr.min(),n,0)}static newNoDocument(e,t){return new Ds(e,2,t,Gr.min(),As.empty(),0)}static newUnknownDocument(e,t){return new Ds(e,3,t,Gr.min(),As.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=As.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=As.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ds&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ds(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Cs{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.v=null}}function Ns(e,t=null,n=[],r=[],s=null,i=null,o=null){return new Cs(e,t,n,r,s,i,o)}function ks(e){const t=e;if(null===t.v){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+vs(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),cs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Ks(t.startAt)),t.endAt&&(e+="|ub:",e+=Ks(t.endAt)),t.v=e}return t.v}function xs(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let o=0;o<e.orderBy.length;o++)if(n=e.orderBy[o],r=t.orderBy[o],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r,s,i;if(e.filters.length!==t.filters.length)return!1;for(let a=0;a<e.filters.length;a++)if(s=e.filters[a],i=t.filters[a],s.op!==i.op||!s.field.isEqual(i.field)||!gs(s.value,i.value))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!zs(e.startAt,t.startAt)&&zs(e.endAt,t.endAt)}function Rs(e){return ds.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Ls extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.V(e,t,n):new Os(e,t,n):"array-contains"===t?new Vs(e,n):"in"===t?new qs(e,n):"not-in"===t?new Us(e,n):"array-contains-any"===t?new Bs(e,n):new Ls(e,t,n)}static V(e,t,n){return new("in"===t?Ms:Ps)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.S(ps(t,this.value)):null!==t&&fs(this.value)===fs(t)&&this.S(ps(t,this.value))}S(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Ar()}}D(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class Os extends Ls{constructor(e,t,n){super(e,t,n),this.key=ds.fromName(n.referenceValue)}matches(e){var t=ds.comparator(e.key,this.key);return this.S(t)}}class Ms extends Ls{constructor(e,t){super(e,"in",t),this.keys=Fs(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Ps extends Ls{constructor(e,t){super(e,"not-in",t),this.keys=Fs(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Fs(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ds.fromName(e.referenceValue))}class Vs extends Ls{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Ts(t)&&ms(t.arrayValue,this.value)}}class qs extends Ls{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&ms(this.value.arrayValue,t)}}class Us extends Ls{constructor(e,t){super(e,"not-in",t)}matches(e){if(ms(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!ms(this.value.arrayValue,t)}}class Bs extends Ls{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ts(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ms(this.value.arrayValue,e))}}class js{constructor(e,t){this.position=e,this.before=t}}function Ks(e){return`${e.before?"b":"a"}:${e.position.map(e=>vs(e)).join(",")}`}class $s{constructor(e,t="asc"){this.field=e,this.dir=t}}function Gs(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?ds.comparator(ds.fromName(o.referenceValue),n.key):ps(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function zs(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!gs(e.position[n],t.position[n]))return!1;return!0}class Ws{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.C=null,this.N=null,this.startAt,this.endAt}}function Hs(e,t,n,r,s,i,o,a){return new Ws(e,t,n,r,s,i,o,a)}function Qs(e){return new Ws(e)}function Ys(e){return!cs(e.limit)&&"F"===e.limitType}function Xs(e){return!cs(e.limit)&&"L"===e.limitType}function Js(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Zs(e){for(const t of e.filters)if(t.D())return t.field;return null}function ei(e){return null!==e.collectionGroup}function ti(t){const n=t;if(null===n.C){n.C=[];const t=Zs(n),e=Js(n);if(null!==t&&null===e)t.isKeyField()||n.C.push(new $s(t)),n.C.push(new $s(Jr.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.C.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.C.push(new $s(Jr.keyField(),t))}}}return n.C}function ni(e){const t=e;if(!t.N)if("F"===t.limitType)t.N=Ns(t.path,t.collectionGroup,ti(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const s of ti(t)){const t="desc"===s.dir?"asc":"desc";e.push(new $s(s.field,t))}var n=t.endAt?new js(t.endAt.position,!t.endAt.before):null,r=t.startAt?new js(t.startAt.position,!t.startAt.before):null;t.N=Ns(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.N}function ri(e,t,n){return new Ws(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function si(e,t){return xs(ni(e),ni(t))&&e.limitType===t.limitType}function ii(e){return`${ks(ni(e))}|lt:${e.limitType}`}function oi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${vs(t.value)}`;var t}).join(", ")}]`),cs(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+Ks(e.startAt)),e.endAt&&(t+=", endAt: "+Ks(e.endAt)),`Target(${t})`}(ni(e))}; limitType=${e.limitType})`}function ai(n,e){return e.isFoundDocument()&&(t=n,s=(r=e).key.path,null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):ds.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(t=e,(!(e=n).startAt||Gs(e.startAt,ti(e),t))&&(!e.endAt||!Gs(e.endAt,ti(e),t)));var t,r,s}function hi(s){return(e,t)=>{let n=!1;for(const r of ti(s)){const s=function(e,s,t){var n=e.field.isKeyField()?ds.comparator(s.key,t.key):function(e,t){var n=s.data.field(e),r=t.data.field(e);return null!==n&&null!==r?ps(n,r):Ar()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Ar()}}(r,e,t);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function ci(e,t){if(e.k){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:us(t)?"-0":t}}function ui(e){return{integerValue:""+e}}function li(e,t){return ls(t)?ui(t):ci(e,t)}class di{constructor(){this._=void 0}}function fi(e,t){return e instanceof wi?bs(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class gi extends di{}class mi extends di{constructor(e){super(),this.elements=e}}function pi(e,t){const n=Ti(t);for(const t of e.elements)n.some(e=>gs(e,t))||n.push(t);return{arrayValue:{values:n}}}class yi extends di{constructor(e){super(),this.elements=e}}function vi(e,t){let n=Ti(t);for(const t of e.elements)n=n.filter(e=>!gs(e,t));return{arrayValue:{values:n}}}class wi extends di{constructor(e,t){super(),this.O=e,this.$=t}}function bi(e){return rs(e.integerValue||e.doubleValue)}function Ti(e){return Ts(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ei{constructor(e,t){this.field=e,this.transform=t}}class Ii{constructor(e,t){this.version=e,this.transformResults=t}}class _i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _i}static exists(e){return new _i(void 0,e)}static updateTime(e){return new _i(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Si(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ai{}function Di(e,t,n){e instanceof xi?function(e,t,n){const r=e.value.clone(),s=Oi(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ri?function(e,t,n){if(!Si(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=Oi(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Li(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function Ci(e,t,n){e instanceof xi?function(e,t,n){if(Si(e.precondition,t)){const r=e.value.clone(),s=Mi(e.fieldTransforms,n,t);r.setAll(s),t.convertToFoundDocument(ki(t),r).setHasLocalMutations()}}(e,t,n):e instanceof Ri?function(e,t,n){if(Si(e.precondition,t)){const r=Mi(e.fieldTransforms,n,t),s=t.data;s.setAll(Li(e)),s.setAll(r),t.convertToFoundDocument(ki(t),s).setHasLocalMutations()}}(e,t,n):(t=t,Si(e.precondition,t)&&t.convertToNoDocument(Gr.min()))}function Ni(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&jr(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof mi&&t instanceof mi||e instanceof yi&&t instanceof yi?jr(e.elements,t.elements,gs):e instanceof wi&&t instanceof wi?gs(e.$,t.$):e instanceof gi&&t instanceof gi)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function ki(e){return e.isFoundDocument()?e.version:Gr.min()}class xi extends Ai{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Ri extends Ai{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function Li(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function Oi(e,t,n){const r=new Map;Dr(e.length===n.length);for(let u=0;u<n.length;u++){var s=e[u],i=s.transform,o=t.data.field(s.field);r.set(s.field,(a=i,h=o,c=n[u],a instanceof mi?pi(a,h):a instanceof yi?vi(a,h):c))}var a,h,c;return r}function Mi(e,t,n){const r=new Map;for(const c of e){const e=c.transform,u=n.data.field(c.field);r.set(c.field,(s=e,i=u,o=t,h=a=void 0,s instanceof gi?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return i&&(e.fields.__previous_value__=i),{mapValue:e}}():s instanceof mi?pi(s,i):s instanceof yi?vi(s,i):(a=fi(s=s,i),h=bi(a)+bi(s.$),bs(a)&&bs(s.$)?ui(h):ci(s.O,h))))}var s,i,o,a,h;return r}class Pi extends Ai{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Fi extends Ai{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class Vi{constructor(e){this.count=e}}function qi(e){switch(e){default:return Ar(),0;case Cr.CANCELLED:case Cr.UNKNOWN:case Cr.DEADLINE_EXCEEDED:case Cr.RESOURCE_EXHAUSTED:case Cr.INTERNAL:case Cr.UNAVAILABLE:case Cr.UNAUTHENTICATED:return;case Cr.INVALID_ARGUMENT:case Cr.NOT_FOUND:case Cr.ALREADY_EXISTS:case Cr.PERMISSION_DENIED:case Cr.FAILED_PRECONDITION:case Cr.ABORTED:case Cr.OUT_OF_RANGE:case Cr.UNIMPLEMENTED:case Cr.DATA_LOSS:return 1}}function Ui(e){if(void 0===e)return Ir("GRPC error has no .code"),Cr.UNKNOWN;switch(e){case ar.OK:return Cr.OK;case ar.CANCELLED:return Cr.CANCELLED;case ar.UNKNOWN:return Cr.UNKNOWN;case ar.DEADLINE_EXCEEDED:return Cr.DEADLINE_EXCEEDED;case ar.RESOURCE_EXHAUSTED:return Cr.RESOURCE_EXHAUSTED;case ar.INTERNAL:return Cr.INTERNAL;case ar.UNAVAILABLE:return Cr.UNAVAILABLE;case ar.UNAUTHENTICATED:return Cr.UNAUTHENTICATED;case ar.INVALID_ARGUMENT:return Cr.INVALID_ARGUMENT;case ar.NOT_FOUND:return Cr.NOT_FOUND;case ar.ALREADY_EXISTS:return Cr.ALREADY_EXISTS;case ar.PERMISSION_DENIED:return Cr.PERMISSION_DENIED;case ar.FAILED_PRECONDITION:return Cr.FAILED_PRECONDITION;case ar.ABORTED:return Cr.ABORTED;case ar.OUT_OF_RANGE:return Cr.OUT_OF_RANGE;case ar.UNIMPLEMENTED:return Cr.UNIMPLEMENTED;case ar.DATA_LOSS:return Cr.DATA_LOSS;default:return Ar()}}(it=ar=ar||{})[it.OK=0]="OK",it[it.CANCELLED=1]="CANCELLED",it[it.UNKNOWN=2]="UNKNOWN",it[it.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",it[it.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",it[it.NOT_FOUND=5]="NOT_FOUND",it[it.ALREADY_EXISTS=6]="ALREADY_EXISTS",it[it.PERMISSION_DENIED=7]="PERMISSION_DENIED",it[it.UNAUTHENTICATED=16]="UNAUTHENTICATED",it[it.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",it[it.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",it[it.ABORTED=10]="ABORTED",it[it.OUT_OF_RANGE=11]="OUT_OF_RANGE",it[it.UNIMPLEMENTED=12]="UNIMPLEMENTED",it[it.INTERNAL=13]="INTERNAL",it[it.UNAVAILABLE=14]="UNAVAILABLE",it[it.DATA_LOSS=15]="DATA_LOSS";class Bi{constructor(e,t){this.comparator=e,this.root=t||Ki.EMPTY}insert(e,t){return new Bi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ki.BLACK,null,null))}remove(e){return new Bi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ki.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ji(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ji(this.root,e,this.comparator,!1)}getReverseIterator(){return new ji(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ji(this.root,e,this.comparator,!0)}}class ji{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ki{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Ki.RED,this.left=null!=r?r:Ki.EMPTY,this.right=null!=s?s:Ki.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Ki(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ki.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ki.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,Ki.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,Ki.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ar();if(this.right.isRed())throw Ar();var e=this.left.check();if(e!==this.right.check())throw Ar();return e+(this.isRed()?0:1)}}Ki.EMPTY=null,Ki.RED=!0,Ki.BLACK=!1,Ki.EMPTY=new class{constructor(){this.size=0}get key(){throw Ar()}get value(){throw Ar()}get color(){throw Ar()}get left(){throw Ar()}get right(){throw Ar()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Ki(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class $i{constructor(e){this.comparator=e,this.data=new Bi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Gi(this.data.getIterator())}getIteratorFrom(e){return new Gi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof $i))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new $i(this.comparator);return t.data=e,t}}class Gi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const zi=new Bi(ds.comparator);const Wi=new Bi(ds.comparator);const Hi=new Bi(ds.comparator),Qi=new $i(ds.comparator);function Yi(...e){let t=Qi;for(const n of e)t=t.add(n);return t}const Xi=new $i(Br);class Ji{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Zi.createSynthesizedTargetChangeForCurrentChange(e,t)),new Ji(Gr.min(),n,Xi,zi,Yi())}}class Zi{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Zi(es.EMPTY_BYTE_STRING,t,Yi(),Yi(),Yi())}}class eo{constructor(e,t,n,r){this.M=e,this.removedTargetIds=t,this.key=n,this.F=r}}class to{constructor(e,t){this.targetId=e,this.L=t}}class no{constructor(e,t,n=es.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ro{constructor(){this.B=0,this.U=oo(),this.q=es.EMPTY_BYTE_STRING,this.K=!1,this.j=!0}get current(){return this.K}get resumeToken(){return this.q}get W(){return 0!==this.B}get G(){return this.j}H(e){0<e.approximateByteSize()&&(this.j=!0,this.q=e)}J(){let n=Yi(),r=Yi(),s=Yi();return this.U.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:s=s.add(e);break;default:Ar()}}),new Zi(this.q,this.K,n,r,s)}Y(){this.j=!1,this.U=oo()}X(e,t){this.j=!0,this.U=this.U.insert(e,t)}Z(e){this.j=!0,this.U=this.U.remove(e)}tt(){this.B+=1}et(){--this.B}nt(){this.j=!0,this.K=!0}}class so{constructor(e){this.st=e,this.it=new Map,this.rt=zi,this.ot=io(),this.ct=new $i(Br)}at(e){for(const t of e.M)e.F&&e.F.isFoundDocument()?this.ut(t,e.F):this.ht(t,e.key,e.F);for(const n of e.removedTargetIds)this.ht(n,e.key,e.F)}lt(n){this.forEachTarget(n,e=>{const t=this.ft(e);switch(n.state){case 0:this.dt(e)&&t.H(n.resumeToken);break;case 1:t.et(),t.W||t.Y(),t.H(n.resumeToken);break;case 2:t.et(),t.W||this.removeTarget(e);break;case 3:this.dt(e)&&(t.nt(),t.H(n.resumeToken));break;case 4:this.dt(e)&&(this.wt(e),t.H(n.resumeToken));break;default:Ar()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.it.forEach((e,t)=>{this.dt(t)&&n(t)})}_t(e){const t=e.targetId,n=e.L.count,r=this.gt(t);if(r){const e=r.target;if(Rs(e))if(0===n){const n=new ds(e.path);this.ht(t,n,Ds.newNoDocument(n,Gr.min()))}else Dr(1===n);else this.yt(t)!==n&&(this.wt(t),this.ct=this.ct.add(t))}}Tt(r){const s=new Map;this.it.forEach((e,t)=>{var n=this.gt(t);if(n){if(e.current&&Rs(n.target)){const s=new ds(n.target.path);null!==this.rt.get(s)||this.Et(t,s)||this.ht(t,s,Ds.newNoDocument(s,r))}e.G&&(s.set(t,e.J()),e.Y())}});let i=Yi();this.ot.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.gt(e);return!t||2===t.purpose||(n=!1)}),n&&(i=i.add(e))}),this.rt.forEach((e,t)=>t.setReadTime(r));var e=new Ji(r,s,this.ct,this.rt,i);return this.rt=zi,this.ot=io(),this.ct=new $i(Br),e}ut(e,t){var n;this.dt(e)&&(n=this.Et(e,t.key)?2:0,this.ft(e).X(t.key,n),this.rt=this.rt.insert(t.key,t),this.ot=this.ot.insert(t.key,this.It(t.key).add(e)))}ht(e,t,n){if(this.dt(e)){const r=this.ft(e);this.Et(e,t)?r.X(t,1):r.Z(t),this.ot=this.ot.insert(t,this.It(t).delete(e)),n&&(this.rt=this.rt.insert(t,n))}}removeTarget(e){this.it.delete(e)}yt(e){var t=this.ft(e).J();return this.st.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}tt(e){this.ft(e).tt()}ft(e){let t=this.it.get(e);return t||(t=new ro,this.it.set(e,t)),t}It(e){let t=this.ot.get(e);return t||(t=new $i(Br),this.ot=this.ot.insert(e,t)),t}dt(e){var t=null!==this.gt(e);return t||Er("WatchChangeAggregator","Detected inactive target",e),t}gt(e){var t=this.it.get(e);return t&&t.W?null:this.st.At(e)}wt(t){this.it.set(t,new ro),this.st.getRemoteKeysForTarget(t).forEach(e=>{this.ht(t,e,null)})}Et(e,t){return this.st.getRemoteKeysForTarget(e).has(t)}}function io(){return new Bi(ds.comparator)}function oo(){return new Bi(ds.comparator)}const ao={asc:"ASCENDING",desc:"DESCENDING"},ho={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class co{constructor(e,t){this.databaseId=e,this.k=t}}function uo(e,t){return e.k?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lo(e,t){return e.k?t.toBase64():t.toUint8Array()}function fo(e){return Dr(!!e),Gr.fromTimestamp((t=ns(e),new $r(t.seconds,t.nanos)));var t}function go(e,t){return e=e,new Yr(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function mo(e){var t=Yr.fromString(e);return Dr(Mo(t)),t}function po(e,t){return go(e.databaseId,t.path)}function yo(e,t){const n=mo(t);if(n.get(1)!==e.databaseId.projectId)throw new Nr(Cr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Nr(Cr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ds(To(n))}function vo(e,t){return go(e.databaseId,t)}function wo(e){var t=mo(e);return 4===t.length?Yr.emptyPath():To(t)}function bo(e){return new Yr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function To(e){return Dr(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Eo(e,t,n){return{name:po(e,t),fields:n.value.mapValue.fields}}function Io(e,t,n){const r=yo(e,t.name),s=fo(t.updateTime),i=new As({mapValue:{fields:t.fields}}),o=Ds.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function _o(e,t){let n;if(t instanceof xi)n={update:Eo(e,t.key,t.value)};else if(t instanceof Pi)n={delete:po(e,t.key)};else if(t instanceof Ri)n={update:Eo(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof Fi))return Ar();n={verify:po(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof gi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof mi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof yi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof wi)return{fieldPath:e.field.canonicalString(),increment:t.$};throw Ar()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,uo(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:Ar()),n;var r}function So(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?_i.updateTime(fo(s.updateTime)):void 0!==s.exists?_i.exists(s.exists):_i.none():_i.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)Dr("REQUEST_TIME"===t.setToServerValue),n=new gi;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new mi(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new yi(e)}else"increment"in t?n=new wi(e,t.increment):Ar();var r=Jr.fromServerFormat(t.fieldPath);return new Ei(r,n)}(t,e)):[];var s;if(n.update){n.update.name;var i=yo(t,n.update.name),o=new As({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new Zr(e.map(e=>Jr.fromServerFormat(e)))}();return new Ri(i,o,t,e,r)}return new xi(i,o,e,r)}if(n.delete){const r=yo(t,n.delete);return new Pi(r,e)}if(n.verify){const r=yo(t,n.verify);return new Fi(r,e)}return Ar()}function Ao(e,t){return{documents:[vo(e,t.path)]}}function Do(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=vo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=vo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s=function(e){if(0!==e.length){var t=e.map(e=>function(e){if("=="===e.op){if(Is(e.value))return{unaryFilter:{field:xo(e.field),op:"IS_NAN"}};if(Es(e.value))return{unaryFilter:{field:xo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Is(e.value))return{unaryFilter:{field:xo(e.field),op:"IS_NOT_NAN"}};if(Es(e.value))return{unaryFilter:{field:xo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xo(e.field),op:(t=e.op,ho[t]),value:e.value}};var t}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);s&&(n.structuredQuery.where=s);s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:xo(e.field),direction:(e=e.dir,ao[e])}}(e))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);var i,s=(i=t.limit,e.k||cs(i)?i:{value:i});return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=No(t.startAt)),t.endAt&&(n.structuredQuery.endAt=No(t.endAt)),n}function Co(e){let t=wo(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(0<r){Dr(1===r);const l=n.from[0];l.allDescendants?s=l.collectionId:t=t.child(l.collectionId)}let i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[Oo(e)]:void 0!==e.fieldFilter?[Lo(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):Ar():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new $s(Ro(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;var h;n.limit&&(a=(e=n.limit,cs(h="object"==typeof e?e.value:e)?null:h));let c=null;n.startAt&&(c=ko(n.startAt));let u=null;return n.endAt&&(u=ko(n.endAt)),Hs(t,s,o,i,a,"F",c,u)}function No(e){return{before:e.before,values:e.position}}function ko(e){var t=!!e.before,n=e.values||[];return new js(n,t)}function xo(e){return{fieldPath:e.canonicalString()}}function Ro(e){return Jr.fromServerFormat(e.fieldPath)}function Lo(e){return Ls.create(Ro(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ar()}}(),e.fieldFilter.value)}function Oo(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Ro(e.unaryFilter.field);return Ls.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=Ro(e.unaryFilter.field);return Ls.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Ro(e.unaryFilter.field);return Ls.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Ro(e.unaryFilter.field);return Ls.create(n,"!=",{nullValue:"NULL_VALUE"});default:return Ar()}}function Mo(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function Po(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=Fo(t)),t=function(e,t){let n=t;const r=e.length;for(let s=0;s<r;s++){const r=e.charAt(s);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return Fo(t)}function Fo(e){return e+""}function Vo(t){const n=t.length;if(Dr(2<=n),2===n)return Dr(""===t.charAt(0)&&""===t.charAt(1)),Yr.emptyPath();const r=n-2,s=[];let i="";for(let o=0;o<n;){const n=t.indexOf("",o);switch((n<0||n>r)&&Ar(),t.charAt(n+1)){case"":const r=t.substring(o,n);let e;0===i.length?e=r:(i+=r,e=i,i=""),s.push(e);break;case"":i+=t.substring(o,n),i+="\0";break;case"":i+=t.substring(o,n+1);break;default:Ar()}o=n+2}return new Yr(s)}class qo{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Uo{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}Uo.store="owner",Uo.key="owner";class Bo{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}Bo.store="mutationQueues",Bo.keyPath="userId";class jo{constructor(e,t,n,r,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}jo.store="mutations",jo.keyPath="batchId",jo.userMutationsIndex="userMutationsIndex",jo.userMutationsKeyPath=["userId","batchId"];class Ko{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Po(t)]}static key(e,t,n){return[e,Po(t),n]}}Ko.store="documentMutations",Ko.PLACEHOLDER=new Ko;class $o{constructor(e,t){this.path=e,this.readTime=t}}class Go{constructor(e,t){this.path=e,this.version=t}}class zo{constructor(e,t,n,r,s,i){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}zo.store="remoteDocuments",zo.readTimeIndex="readTimeIndex",zo.readTimeIndexPath="readTime",zo.collectionReadTimeIndex="collectionReadTimeIndex",zo.collectionReadTimeIndexPath=["parentPath","readTime"];class Wo{constructor(e){this.byteSize=e}}Wo.store="remoteDocumentGlobal",Wo.key="remoteDocumentGlobalKey";class Ho{constructor(e,t,n,r,s,i,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Ho.store="targets",Ho.keyPath="targetId",Ho.queryTargetsIndexName="queryTargetsIndex",Ho.queryTargetsKeyPath=["canonicalId","targetId"];class Qo{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}Qo.store="targetDocuments",Qo.keyPath=["targetId","path"],Qo.documentTargetsIndex="documentTargetsIndex",Qo.documentTargetsKeyPath=["path","targetId"];class Yo{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Yo.key="targetGlobalKey",Yo.store="targetGlobal";class Xo{constructor(e,t){this.collectionId=e,this.parent=t}}Xo.store="collectionParents",Xo.keyPath=["collectionId","parent"];class Jo{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}Jo.store="clientMetadata",Jo.keyPath="clientId";class Zo{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}Zo.store="bundles",Zo.keyPath="bundleId";class ea{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}ea.store="namedQueries",ea.keyPath="name";class ta{constructor(e,t,n){this.indexId=e,this.collectionGroup=t,this.fields=n}}ta.store="indexConfiguration",ta.keyPath="indexId";class na{constructor(e,t,n,r,s,i){this.indexId=e,this.uid=t,this.sequenceNumber=n,this.readTime=r,this.documentKey=s,this.largestBatchId=i}}na.store="indexState",na.keyPath=["indexId","uid"];class ra{constructor(e,t,n,r,s){this.indexId=e,this.uid=t,this.arrayValue=n,this.directionalValue=r,this.documentKey=s}}ra.store="indexEntries",ra.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"];const sa=[Bo.store,jo.store,Ko.store,zo.store,Ho.store,Uo.store,Yo.store,Qo.store,Jo.store,Wo.store,Xo.store,Zo.store,ea.store],ia="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oa{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class aa{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,s){return this.callbackAttached&&Ar(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new aa((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(s,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof aa?t:aa.resolve(t)}catch(e){return aa.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):aa.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):aa.reject(t)}static resolve(n){return new aa((e,t)=>{e(n)})}static reject(n){return new aa((e,t)=>{t(n)})}static waitFor(e){return new aa((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=aa.resolve(!1);for(const n of e)t=t.next(e=>e?aa.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class ha{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.Rt=new kr,this.transaction.oncomplete=()=>{this.Rt.resolve()},this.transaction.onabort=()=>{e.error?this.Rt.reject(new la(n,e.error)):this.Rt.resolve()},this.transaction.onerror=e=>{var t=pa(e.target.error);this.Rt.reject(new la(n,t))}}static open(e,t,n,r){try{return new ha(t,e.transaction(r,n))}catch(e){throw new la(t,e)}}get bt(){return this.Rt.promise}abort(e){e&&this.Rt.reject(e),this.aborted||(Er("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){var t=this.transaction.objectStore(e);return new fa(t)}}class ca{constructor(e,t,n){this.name=e,this.version=t,this.Pt=n,12.2===ca.vt(f())&&Ir("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Er("SimpleDb","Removing database:",e),ga(window.indexedDB.deleteDatabase(e)).toPromise()}static Vt(){if("object"!=typeof indexedDB)return!1;if(ca.St())return!0;const e=f(),t=ca.vt(e),n=0<t&&t<10,r=ca.Dt(e),s=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||s)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static Nt(e,t){return e.store(t)}static vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async kt(i){return this.db||(Er("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=e=>{var t=e.target.result;n(t)},s.onblocked=()=>{r(new la(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new Nr(Cr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new Nr(Cr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new la(i,t))},s.onupgradeneeded=e=>{Er("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.Pt.xt(t,s.transaction,e.oldVersion,this.version).next(()=>{Er("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.$t&&(this.db.onversionchange=e=>this.$t(e)),this.db}Ot(t){this.$t=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.kt(e);const t=ha.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).catch(e=>(t.abort(e),aa.reject(e))).toPromise();return i.catch(()=>{}),await t.bt,i}catch(e){const t="FirebaseError"!==e.name&&i<3;if(Er("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ua{constructor(e){this.Mt=e,this.Ft=!1,this.Lt=null}get isDone(){return this.Ft}get Bt(){return this.Lt}set cursor(e){this.Mt=e}done(){this.Ft=!0}Ut(e){this.Lt=e}delete(){return ga(this.Mt.delete())}}class la extends Nr{constructor(e,t){super(Cr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function da(e){return"IndexedDbTransactionError"===e.name}class fa{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(Er("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(Er("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),ga(n)}add(e){return Er("SimpleDb","ADD",this.store.name,e,e),ga(this.store.add(e))}get(t){return ga(this.store.get(t)).next(e=>(Er("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return Er("SimpleDb","DELETE",this.store.name,e),ga(this.store.delete(e))}count(){return Er("SimpleDb","COUNT",this.store.name),ga(this.store.count())}qt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Kt(n,(e,t)=>{r.push(t)}).next(()=>r)}jt(e,t){Er("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Qt=!1;var r=this.cursor(n);return this.Kt(r,(e,t,n)=>n.delete())}Wt(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Kt(r,t)}Gt(s){const e=this.cursor({});return new aa((n,r)=>{e.onerror=e=>{var t=pa(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?s(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Kt(e,i){const o=[];return new aa((s,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new ua(t),r=i(t.primaryKey,t.value,n);if(r instanceof aa){const e=r.catch(e=>(n.done(),aa.reject(e)));o.push(e)}n.isDone?s():null===n.Bt?t.continue():t.continue(n.Bt)}else s()}}).next(()=>aa.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ga(e){return new aa((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=pa(e.target.error);r(t)}})}let ma=!1;function pa(e){const t=ca.vt(f());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new Nr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ma||(ma=!0,setTimeout(()=>{throw e},0)),e}}return e}class ya extends oa{constructor(e,t){super(),this.zt=e,this.currentSequenceNumber=t}}function va(e,t){var n=e;return ca.Nt(n.zt,t)}class wa{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&Di(s,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Ci(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&Ci(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(Gr.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Yi())}isEqual(e){return this.batchId===e.batchId&&jr(this.mutations,e.mutations,(e,t)=>Ni(e,t))&&jr(this.baseMutations,e.baseMutations,(e,t)=>Ni(e,t))}}class ba{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Dr(e.mutations.length===n.length);let r=Hi;var s=e.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new ba(e,t,n,r)}}class Ta{constructor(e,t,n,r,s=Gr.min(),i=Gr.min(),o=es.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(e){return new Ta(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Ta(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Ta(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ea{constructor(e){this.Ht=e}}function Ia(e,t){let n;if(t.document)n=Io(e.Ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ds.fromSegments(t.noDocument.path),r=Ca(t.noDocument.readTime);n=Ds.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Ar();{const e=ds.fromSegments(t.unknownDocument.path),s=Ca(t.unknownDocument.version);n=Ds.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime(Aa(t.readTime)),n}function _a(e,t){var n,r=Sa(t.readTime),s=t.key.path.popLast().toArray();if(t.isFoundDocument()){var i={name:po(n=e.Ht,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:uo(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new zo(null,null,i,o,r,s)}if(t.isNoDocument()){const a=t.key.path.toArray(),h=Da(t.version),c=t.hasCommittedMutations;return new zo(null,new $o(a,h),null,c,r,s)}if(t.isUnknownDocument()){const a=t.key.path.toArray(),u=Da(t.version);return new zo(new Go(a,u),null,null,!0,r,s)}return Ar()}function Sa(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Aa(e){var t=new $r(e[0],e[1]);return Gr.fromTimestamp(t)}function Da(e){var t=e.toTimestamp();return new qo(t.seconds,t.nanoseconds)}function Ca(e){var t=new $r(e.seconds,e.nanoseconds);return Gr.fromTimestamp(t)}function Na(t,e){const n=(e.baseMutations||[]).map(e=>So(t.Ht,e));for(let i=0;i<e.mutations.length-1;++i){const n=e.mutations[i];if(i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform){const r=e.mutations[i+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(e=>So(t.Ht,e)),s=$r.fromMillis(e.localWriteTimeMs);return new wa(e.batchId,s,n,r)}function ka(e){var t,n=Ca(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?Ca(e.lastLimboFreeSnapshotVersion):Gr.min();let s;return s=void 0!==e.query.documents?(Dr(1===(t=e.query).documents.length),ni(Qs(wo(t.documents[0])))):ni(Co(e.query)),new Ta(s,e.targetId,0,e.lastListenSequenceNumber,n,r,es.fromBase64String(e.resumeToken))}function xa(e,t){var n=Da(t.snapshotVersion),r=Da(t.lastLimboFreeSnapshotVersion),s=(Rs(t.target)?Ao:Do)(e.Ht,t.target),i=t.resumeToken.toBase64();return new Ho(t.targetId,ks(t.target),n,i,t.sequenceNumber,r,s)}function Ra(e){var t=Co({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ri(t,t.limit,"L"):t}class La{getBundleMetadata(e,t){return Oa(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Ca(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return Oa(e).put({bundleId:(n=t).id,createTime:Da(fo(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Ma(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:Ra(t.bundledQuery),readTime:Ca(t.readTime)};var t})}saveNamedQuery(e,t){return Ma(e).put({name:(t=t).name,readTime:Da(fo(t.readTime)),bundledQuery:t.bundledQuery})}}function Oa(e){return va(e,Zo.store)}function Ma(e){return va(e,ea.store)}class Pa{constructor(){this.Jt=new Fa}addToCollectionParentIndex(e,t){return this.Jt.add(t),aa.resolve()}getCollectionParents(e,t){return aa.resolve(this.Jt.getEntries(t))}}class Fa{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new $i(Yr.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new $i(Yr.comparator)).toArray()}}class Va{constructor(){this.Yt=new Fa}addToCollectionParentIndex(e,t){if(this.Yt.has(t))return aa.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Yt.add(t)});r={collectionId:n,parent:Po(r)};return qa(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Kr(n),""],!1,!0);return qa(e).qt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Vo(t.parent))}return r})}}function qa(e){return va(e,Xo.store)}const Ua={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ba{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ba(e,Ba.DEFAULT_COLLECTION_PERCENTILE,Ba.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ja(e,t,n){const r=e.store(jo.store),s=e.store(Ko.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=r.Wt({range:o},(e,t,n)=>(a++,n.delete()));i.push(h.next(()=>{Dr(1===a)}));const c=[];for(const e of n.mutations){const r=Ko.key(t,e.key.path,n.batchId);i.push(s.delete(r)),c.push(e.key)}return aa.waitFor(i).next(()=>c)}function Ka(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Ar();t=e.noDocument}return JSON.stringify(t).length}Ba.DEFAULT_COLLECTION_PERCENTILE=10,Ba.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ba.DEFAULT=new Ba(41943040,Ba.DEFAULT_COLLECTION_PERCENTILE,Ba.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ba.DISABLED=new Ba(-1,0,0);class $a{constructor(e,t,n,r){this.userId=e,this.O=t,this.Xt=n,this.referenceDelegate=r,this.Zt={}}static te(e,t,n,r){Dr(""!==e.uid);var s=e.isAuthenticated()?e.uid:"";return new $a(s,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return za(e).Wt({index:jo.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,l,d,f){const g=Wa(u),m=za(u);return m.add({}).next(e=>{Dr("number"==typeof e);const t=new wa(e,l,d,f),n=(s=this.O,i=this.userId,o=t,a=o.baseMutations.map(e=>_o(s.Ht,e)),h=o.mutations.map(e=>_o(s.Ht,e)),new jo(i,o.batchId,o.localWriteTime.toMillis(),a,h)),r=[];var s,i,o,a,h;let c=new $i((e,t)=>Br(e.canonicalString(),t.canonicalString()));for(const u of f){const l=Ko.key(this.userId,u.key.path,e);c=c.add(u.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,Ko.PLACEHOLDER))}return c.forEach(e=>{r.push(this.Xt.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Zt[e]=t.keys()}),aa.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return za(e).get(t).next(e=>e?(Dr(e.userId===this.userId),Na(this.O,e)):null)}ee(e,n){return this.Zt[n]?aa.resolve(this.Zt[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.Zt[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return za(e).Wt({index:jo.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(Dr(t.batchId>=r),s=Na(this.O,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return za(e).Wt({index:jo.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return za(e).qt(jo.userMutationsIndex,t).next(e=>e.map(e=>Na(this.O,e)))}getAllMutationBatchesAffectingDocumentKey(o,a){const e=Ko.prefixForPath(this.userId,a.path),t=IDBKeyRange.lowerBound(e),h=[];return Wa(o).Wt({range:t},(e,t,n)=>{var[r,s,i]=e,s=Vo(s);if(r===this.userId&&a.path.isEqual(s))return za(o).get(i).next(e=>{if(!e)throw Ar();Dr(e.userId===this.userId),h.push(Na(this.O,e))});n.done()}).next(()=>h)}getAllMutationBatchesAffectingDocumentKeys(t,e){let a=new $i(Br);const n=[];return e.forEach(o=>{var e=Ko.prefixForPath(this.userId,o.path),e=IDBKeyRange.lowerBound(e),e=Wa(t).Wt({range:e},(e,t,n)=>{var[r,s,i]=e,s=Vo(s);r===this.userId&&o.path.isEqual(s)?a=a.add(i):n.done()});n.push(e)}),aa.waitFor(n).next(()=>this.ne(t,a))}getAllMutationBatchesAffectingQuery(e,t){const o=t.path,a=o.length+1,n=Ko.prefixForPath(this.userId,o),r=IDBKeyRange.lowerBound(n);let h=new $i(Br);return Wa(e).Wt({range:r},(e,t,n)=>{var[r,s,i]=e,s=Vo(s);r===this.userId&&o.isPrefixOf(s)?s.length===a&&(h=h.add(i)):n.done()}).next(()=>this.ne(e,h))}ne(t,e){const n=[],r=[];return e.forEach(e=>{r.push(za(t).get(e).next(e=>{if(null===e)throw Ar();Dr(e.userId===this.userId),n.push(Na(this.O,e))}))}),aa.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return ja(t.zt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.se(n.batchId)}),aa.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}se(e){delete this.Zt[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return aa.resolve();const t=IDBKeyRange.lowerBound(Ko.prefixForUser(this.userId)),r=[];return Wa(n).Wt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Vo(e[1]);r.push(t)}else n.done()}).next(()=>{Dr(0===r.length)})})}containsKey(e,t){return Ga(e,this.userId,t)}ie(e){return Ha(e).get(this.userId).next(e=>e||new Bo(this.userId,-1,""))}}function Ga(e,i,t){const n=Ko.prefixForPath(i,t.path),o=n[1],r=IDBKeyRange.lowerBound(n);let a=!1;return Wa(e).Wt({range:r,Qt:!0},(e,t,n)=>{var[r,s]=e;r===i&&s===o&&(a=!0),n.done()}).next(()=>a)}function za(e){return va(e,jo.store)}function Wa(e){return va(e,Ko.store)}function Ha(e){return va(e,Bo.store)}class Qa{constructor(e){this.re=e}next(){return this.re+=2,this.re}static oe(){return new Qa(0)}static ce(){return new Qa(-1)}}class Ya{constructor(e,t){this.referenceDelegate=e,this.O=t}allocateTargetId(n){return this.ae(n).next(e=>{const t=new Qa(e.highestTargetId);return e.highestTargetId=t.next(),this.ue(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ae(e).next(e=>Gr.fromTimestamp(new $r(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ae(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.ae(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.ue(t,e)))}addTargetData(t,n){return this.he(t,n).next(()=>this.ae(t).next(e=>(e.targetCount+=1,this.le(n,e),this.ue(t,e))))}updateTargetData(e,t){return this.he(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Xa(t).delete(e.targetId)).next(()=>this.ae(t)).next(e=>(Dr(0<e.targetCount),--e.targetCount,this.ue(t,e)))}removeTargets(r,s,i){let o=0;const a=[];return Xa(r).Wt((e,t)=>{var n=ka(t);n.sequenceNumber<=s&&null===i.get(n.targetId)&&(o++,a.push(this.removeTargetData(r,n)))}).next(()=>aa.waitFor(a)).next(()=>o)}forEachTarget(e,r){return Xa(e).Wt((e,t)=>{var n=ka(t);r(n)})}ae(e){return Ja(e).get(Yo.key).next(e=>(Dr(null!==e),e))}ue(e,t){return Ja(e).put(Yo.key,t)}he(e,t){return Xa(e).put(xa(this.O,t))}le(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.ae(e).next(e=>e.targetCount)}getTargetData(e,s){var t=ks(s),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return Xa(e).Wt({range:t,index:Ho.queryTargetsIndexName},(e,t,n)=>{var r=ka(t);xs(s,r.target)&&(i=r,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const s=[],i=Za(n);return e.forEach(e=>{var t=Po(e.path);s.push(i.put(new Qo(r,t))),s.push(this.referenceDelegate.addReference(n,r,e))}),aa.waitFor(s)}removeMatchingKeys(n,e,r){const s=Za(n);return aa.forEach(e,e=>{var t=Po(e.path);return aa.waitFor([s.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=Za(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Za(e);let s=Yi();return r.Wt({range:n,Qt:!0},(e,t,n)=>{var r=Vo(e[1]),r=new ds(r);s=s.add(r)}).next(()=>s)}containsKey(e,t){var n=Po(t.path),n=IDBKeyRange.bound([n],[Kr(n)],!1,!0);let r=0;return Za(e).Wt({index:Qo.documentTargetsIndex,Qt:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}At(e,t){return Xa(e).get(t).next(e=>e?ka(e):null)}}function Xa(e){return va(e,Ho.store)}function Ja(e){return va(e,Yo.store)}function Za(e){return va(e,Qo.store)}async function eh(e){if(e.code!==Cr.FAILED_PRECONDITION||e.message!==ia)throw e;Er("LocalStore","Unexpectedly lost primary lease")}function th([e,t],[n,r]){var s=Br(e,n);return 0===s?Br(t,r):s}class nh{constructor(e){this.fe=e,this.buffer=new $i(th),this.de=0}we(){return++this.de}_e(e){var t=[e,this.we()];if(this.buffer.size<this.fe)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();th(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rh{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.me=!1,this.ge=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ye(e)}stop(){this.ge&&(this.ge.cancel(),this.ge=null)}get started(){return null!==this.ge}ye(e){var t=this.me?3e5:6e4;Er("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.ge=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.ge=null,this.me=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){da(e)?Er("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await eh(e)}await this.ye(e)})}}class sh{constructor(e,t){this.pe=e,this.params=t}calculateTargetCount(e,t){return this.pe.Te(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return aa.resolve(qr.I);const n=new nh(t);return this.pe.forEachTarget(e,e=>n._e(e.sequenceNumber)).next(()=>this.pe.Ee(e,e=>n._e(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.pe.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.pe.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(Er("LruGarbageCollector","Garbage collection skipped; disabled"),aa.resolve(Ua)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(Er("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ua):this.Ie(t,n))}getCacheSize(e){return this.pe.getCacheSize(e)}Ie(t,n){let r,s,i,o,a,h,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(s=e>this.params.maximumSequenceNumbersToCollect?(Er("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,s))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(i=e,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),Tr()<=l.DEBUG&&Er("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${s} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(h-a)+"ms\n"+`\tRemoved ${e} documents in `+(c-h)+"ms\n"+`Total Duration: ${c-u}ms`),aa.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e})))}}class ih{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new sh(e,t))}Te(e){const n=this.Ae(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Ae(e){let t=0;return this.Ee(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ee(e,n){return this.Re(e,(e,t)=>n(t))}addReference(e,t,n){return oh(e,n)}removeReference(e,t,n){return oh(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return oh(e,t)}be(t,n){let r=!1;return Ha(t).Gt(e=>Ga(t,e,n).next(e=>(e&&(r=!0),aa.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.Re(n,(t,e)=>{if(e<=r){const r=this.be(n,t).next(e=>{if(!e)return o++,s.getEntry(n,t).next(()=>(s.removeEntry(t,Gr.min()),Za(n).delete([0,Po(t.path)])))});i.push(r)}}).next(()=>aa.waitFor(i)).next(()=>s.apply(n)).next(()=>o)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return oh(e,t)}Re(e,r){const t=Za(e);let s,i=qr.I;return t.Wt({index:Qo.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(i!==qr.I&&r(new ds(Vo(s)),i),i=n,s=t):i=qr.I}).next(()=>{i!==qr.I&&r(new ds(Vo(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oh(e,t){return Za(e).put((t=t,e=e.currentSequenceNumber,new Qo(0,Po(t.path),e)))}class ah{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(r){Wr(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return Hr(this.inner)}}class hh{constructor(){this.changes=new ah(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ds.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?aa.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ch{constructor(e,t){this.O=e,this.Xt=t}addEntry(e,t,n){return dh(e).put(fh(t),n)}removeEntry(e,t){const n=dh(e),r=fh(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Pe(t,e)))}getEntry(e,t){return dh(e).get(fh(t)).next(e=>this.ve(t,e))}Ve(e,t){return dh(e).get(fh(t)).next(e=>({document:this.ve(t,e),size:Ka(e)}))}getEntries(e,t){let r=zi;return this.Se(e,t,(e,t)=>{var n=this.ve(e,t);r=r.insert(e,n)}).next(()=>r)}De(e,t){let r=zi,s=new Bi(ds.comparator);return this.Se(e,t,(e,t)=>{var n=this.ve(e,t);r=r.insert(e,n),s=s.insert(e,Ka(t))}).next(()=>({documents:r,Ce:s}))}Se(e,t,s){if(t.isEmpty())return aa.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return dh(e).Wt({range:n},(e,t,n)=>{for(var r=ds.fromSegments(e);o&&ds.comparator(o,r)<0;)s(o,null),o=i.getNext();o&&o.isEqual(r)&&(s(o,t),o=i.hasNext()?i.getNext():null),o?n.Ut(o.path.toArray()):n.done()}).next(()=>{for(;o;)s(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,s,t){let i=zi;const o=s.path.length+1,n={};if(t.isEqual(Gr.min())){const e=s.path.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=s.path.toArray(),i=Sa(t);n.range=IDBKeyRange.lowerBound([e,i],!0),n.index=zo.collectionReadTimeIndex}return dh(e).Wt(n,(e,t,n)=>{var r;e.length===o&&(r=this.ve(ds.fromSegments(e),t),s.path.isPrefixOf(r.key.path)?ai(s,r)&&(i=i.insert(r.key,r)):n.done())}).next(()=>i)}newChangeBuffer(e){return new uh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return lh(e).get(Wo.key).next(e=>(Dr(!!e),e))}Pe(e,t){return lh(e).put(Wo.key,t)}ve(e,t){if(t){const e=Ia(this.O,t);if(!e.isNoDocument()||!e.version.isEqual(Gr.min()))return e}return Ds.newInvalidDocument(e)}}class uh extends hh{constructor(e,t){super(),this.Ne=e,this.trackRemovals=t,this.ke=new ah(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const o=[];let a=0,h=new $i((e,t)=>Br(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.ke.get(e);if(t.isValidDocument()){var r=_a(this.Ne.O,t);h=h.add(e.path.popLast());var s=Ka(r);a+=s-n,o.push(this.Ne.addEntry(i,e,r))}else if(a-=n,this.trackRemovals){const a=_a(this.Ne.O,t.convertToNoDocument(Gr.min()));o.push(this.Ne.addEntry(i,e,a))}else o.push(this.Ne.removeEntry(i,e))}),h.forEach(e=>{o.push(this.Ne.Xt.addToCollectionParentIndex(i,e))}),o.push(this.Ne.updateMetadata(i,a)),aa.waitFor(o)}getFromCache(e,t){return this.Ne.Ve(e,t).next(e=>(this.ke.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Ne.De(e,t).next(({documents:e,Ce:t})=>(t.forEach((e,t)=>{this.ke.set(e,t)}),e))}}function lh(e){return va(e,Wo.store)}function dh(e){return va(e,zo.store)}function fh(e){return e.path.toArray()}class gh{constructor(e){this.O=e}xt(t,n,e,r){const s=new ha("createOrUpgrade",n);var i;e<1&&1<=r&&(t.createObjectStore(Uo.store),(i=t).createObjectStore(Bo.store,{keyPath:Bo.keyPath}),i.createObjectStore(jo.store,{keyPath:jo.keyPath,autoIncrement:!0}).createIndex(jo.userMutationsIndex,jo.userMutationsKeyPath,{unique:!0}),i.createObjectStore(Ko.store),mh(t),t.createObjectStore(zo.store));let o=aa.resolve();return e<3&&3<=r&&(0!==e&&((i=t).deleteObjectStore(Qo.store),i.deleteObjectStore(Ho.store),i.deleteObjectStore(Yo.store),mh(t)),o=o.next(()=>function(){const e=s.store(Yo.store),t=new Yo(0,0,Gr.min().toTimestamp(),0);return e.put(Yo.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,s){return s.store(jo.store).qt().next(e=>{r.deleteObjectStore(jo.store),r.createObjectStore(jo.store,{keyPath:jo.keyPath,autoIncrement:!0}).createIndex(jo.userMutationsIndex,jo.userMutationsKeyPath,{unique:!0});const t=s.store(jo.store),n=e.map(e=>t.put(e));return aa.waitFor(n)})}(t,s))),o=o.next(()=>{t.createObjectStore(Jo.store,{keyPath:Jo.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.xe(s))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(Wo.store),this.$e(s)))),e<7&&7<=r&&(o=o.next(()=>this.Oe(s))),e<8&&8<=r&&(o=o.next(()=>this.Me(t,s))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(zo.store);e.createIndex(zo.readTimeIndex,zo.readTimeIndexPath,{unique:!1}),e.createIndex(zo.collectionReadTimeIndex,zo.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.Fe(s))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(Zo.store,{keyPath:Zo.keyPath}),t.createObjectStore(ea.store,{keyPath:ea.keyPath})})),e<12&&12<=r&&(o=o.next(()=>{var e;(e=t).createObjectStore(ta.store,{keyPath:ta.keyPath}),e.createObjectStore(na.store,{keyPath:na.keyPath}),e.createObjectStore(ra.store,{keyPath:ra.keyPath})})),o}$e(t){let n=0;return t.store(zo.store).Wt((e,t)=>{n+=Ka(t)}).next(()=>{var e=new Wo(n);return t.store(Wo.store).put(Wo.key,e)})}xe(r){const e=r.store(Bo.store),t=r.store(jo.store);return e.qt().next(e=>aa.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.qt(jo.userMutationsIndex,e).next(e=>aa.forEach(e,e=>{Dr(e.userId===n.userId);var t=Na(this.O,e);return ja(r,n.userId,t).next(()=>{})}))}))}Oe(e){const o=e.store(Qo.store),t=e.store(zo.store);return e.store(Yo.store).get(Yo.key).next(s=>{const i=[];return t.Wt((e,t)=>{const n=new Yr(e),r=[0,Po(n)];i.push(o.get(r).next(e=>e?aa.resolve():(e=>o.put(new Qo(0,Po(e),s.highestListenSequenceNumber)))(n)))}).next(()=>aa.waitFor(i))})}Me(e,t){e.createObjectStore(Xo.store,{keyPath:Xo.keyPath});const n=t.store(Xo.store),r=new Fa,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Po(r)})}};return t.store(zo.store).Wt({Qt:!0},(e,t)=>{const n=new Yr(e);return s(n.popLast())}).next(()=>t.store(Ko.store).Wt({Qt:!0},([,e],t)=>{const n=Vo(e);return s(n.popLast())}))}Fe(e){const r=e.store(Ho.store);return r.Wt((e,t)=>{var n=ka(t),n=xa(this.O,n);return r.put(n)})}}function mh(e){e.createObjectStore(Qo.store,{keyPath:Qo.keyPath}).createIndex(Qo.documentTargetsIndex,Qo.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Ho.store,{keyPath:Ho.keyPath}).createIndex(Ho.queryTargetsIndexName,Ho.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Yo.store)}const ph="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class yh{constructor(e,t,n,r,s,i,o,a,h,c){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Le=s,this.window=i,this.document=o,this.Be=h,this.Ue=c,this.qe=null,this.Ke=!1,this.isPrimary=!1,this.networkEnabled=!0,this.je=null,this.inForeground=!1,this.Qe=null,this.We=null,this.Ge=Number.NEGATIVE_INFINITY,this.ze=e=>Promise.resolve(),!yh.Vt())throw new Nr(Cr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ih(this,r),this.He=t+"main",this.O=new Ea(a),this.Je=new ca(this.He,11,new gh(this.O)),this.Ye=new Ya(this.referenceDelegate,this.O),this.Xt=new Va,this.Xe=(t=this.O,a=this.Xt,new ch(t,a)),this.Ze=new La,this.window&&this.window.localStorage?this.tn=this.window.localStorage:(this.tn=null,!1===c&&Ir("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.en().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Nr(Cr.FAILED_PRECONDITION,ph);return this.nn(),this.sn(),this.rn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ye.getHighestSequenceNumber(e))}).then(e=>{this.qe=new qr(e,this.Be)}).then(()=>{this.Ke=!0}).catch(e=>(this.Je&&this.Je.close(),Promise.reject(e)))}on(t){return this.ze=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Je.Ot(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Le.enqueueAndForget(async()=>{this.started&&await this.en()}))}en(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>wh(t).put(new Jo(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.cn(t).next(e=>{e||(this.isPrimary=!1,this.Le.enqueueRetryable(()=>this.ze(!1)))})}).next(()=>this.an(t)).next(e=>this.isPrimary&&!e?this.un(t).next(()=>!1):!!e&&this.hn(t).next(()=>!0))).catch(e=>{if(da(e))return Er("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Er("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Le.enqueueRetryable(()=>this.ze(e)),this.isPrimary=e})}cn(e){return vh(e).get(Uo.key).next(e=>aa.resolve(this.ln(e)))}fn(e){return wh(e).delete(this.clientId)}async dn(){if(this.isPrimary&&!this.wn(this.Ge,18e5)){this.Ge=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=va(e,Jo.store);return r.qt().next(e=>{const t=this._n(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return aa.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.tn)for(const t of e)this.tn.removeItem(this.mn(t.clientId))}}rn(){this.We=this.Le.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.en().then(()=>this.dn()).then(()=>this.rn()))}ln(e){return!!e&&e.ownerId===this.clientId}an(t){return this.Ue?aa.resolve(!0):vh(t).get(Uo.key).next(e=>{if(null!==e&&this.wn(e.leaseTimestampMs,5e3)&&!this.gn(e.ownerId)){if(this.ln(e)&&this.networkEnabled)return!0;if(!this.ln(e)){if(!e.allowTabSynchronization)throw new Nr(Cr.FAILED_PRECONDITION,ph);return!1}}return!(!this.networkEnabled||!this.inForeground)||wh(t).qt().next(e=>void 0===this._n(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&Er("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ke=!1,this.yn(),this.We&&(this.We.cancel(),this.We=null),this.pn(),this.Tn(),await this.Je.runTransaction("shutdown","readwrite",[Uo.store,Jo.store],e=>{const t=new ya(e,qr.I);return this.un(t).next(()=>this.fn(t))}),this.Je.close(),this.En()}_n(e,t){return e.filter(e=>this.wn(e.updateTimeMs,t)&&!this.gn(e.clientId))}In(){return this.runTransaction("getActiveClients","readonly",e=>wh(e).qt().next(e=>this._n(e,18e5).map(e=>e.clientId)))}get started(){return this.Ke}getMutationQueue(e){return $a.te(e,this.O,this.Xt,this.referenceDelegate)}getTargetCache(){return this.Ye}getRemoteDocumentCache(){return this.Xe}getIndexManager(){return this.Xt}getBundleCache(){return this.Ze}runTransaction(t,n,r){Er("IndexedDbPersistence","Starting transaction:",t);let s;return this.Je.runTransaction(t,"readonly"===n?"readonly":"readwrite",sa,e=>(s=new ya(e,this.qe?this.qe.next():qr.I),"readwrite-primary"===n?this.cn(s).next(e=>!!e||this.an(s)).next(e=>{if(!e)throw Ir(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Le.enqueueRetryable(()=>this.ze(!1)),new Nr(Cr.FAILED_PRECONDITION,ia);return r(s)}).next(e=>this.hn(s).next(()=>e)):this.An(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}An(e){return vh(e).get(Uo.key).next(e=>{if(null!==e&&this.wn(e.leaseTimestampMs,5e3)&&!this.gn(e.ownerId)&&!this.ln(e)&&!(this.Ue||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Nr(Cr.FAILED_PRECONDITION,ph)})}hn(e){var t=new Uo(this.clientId,this.allowTabSynchronization,Date.now());return vh(e).put(Uo.key,t)}static Vt(){return ca.Vt()}un(e){const t=vh(e);return t.get(Uo.key).next(e=>this.ln(e)?(Er("IndexedDbPersistence","Releasing primary lease."),t.delete(Uo.key)):aa.resolve())}wn(e,t){var n=Date.now();return!(e<n-t||n<e&&(Ir(`Detected an update time that is in the future: ${e} > ${n}`),1))}nn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qe=()=>{this.Le.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.en()))},this.document.addEventListener("visibilitychange",this.Qe),this.inForeground="visible"===this.document.visibilityState)}pn(){this.Qe&&(this.document.removeEventListener("visibilitychange",this.Qe),this.Qe=null)}sn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.je=()=>{this.yn(),s()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Le.enterRestrictedMode(!0),this.Le.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.je))}Tn(){this.je&&(this.window.removeEventListener("pagehide",this.je),this.je=null)}gn(e){var t;try{var n=null!==(null===(t=this.tn)||void 0===t?void 0:t.getItem(this.mn(e)));return Er("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Ir("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}yn(){if(this.tn)try{this.tn.setItem(this.mn(this.clientId),String(Date.now()))}catch(e){Ir("Failed to set zombie client id.",e)}}En(){if(this.tn)try{this.tn.removeItem(this.mn(this.clientId))}catch(e){}}mn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function vh(e){return va(e,Uo.store)}function wh(e){return va(e,Jo.store)}function bh(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Th{constructor(e,t){this.progress=e,this.Rn=t}}class Eh{constructor(e,t,n){this.Xe=e,this.bn=t,this.Xt=n}Pn(t,n){return this.bn.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.vn(t,n,e))}vn(e,t,n){return this.Xe.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Vn(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}Sn(t,e){return this.Xe.getEntries(t,e).next(e=>this.Dn(t,e).next(()=>e))}Dn(e,t){return this.bn.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Vn(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,ds.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Cn(e,t.path):ei(t)?this.Nn(e,t,n):this.kn(e,t,n);var r}Cn(e,t){return this.Pn(e,new ds(t)).next(e=>{let t=Wi;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Nn(r,s,i){const o=s.collectionGroup;let a=Wi;return this.Xt.getCollectionParents(r,o).next(e=>aa.forEach(e,e=>{var t,n=(t=s,e=e.child(o),new Ws(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.kn(r,n,i).next(e=>{e.forEach((e,t)=>{a=a.insert(e,t)})})}).next(()=>a))}kn(t,n,e){let s,i;return this.Xe.getDocumentsMatchingQuery(t,n,e).next(e=>(s=e,this.bn.getAllMutationBatchesAffectingQuery(t,n))).next(e=>(i=e,this.xn(t,i,s).next(t=>{s=t;for(const t of i)for(const r of t.mutations){var n=r.key;let e=s.get(n);null==e&&(e=Ds.newInvalidDocument(n),s=s.insert(n,e)),Ci(r,e,t.localWriteTime),e.isFoundDocument()||(s=s.remove(n))}}))).next(()=>(s.forEach((e,t)=>{ai(n,t)||(s=s.remove(e))}),s))}xn(e,t,n){let r=Yi();for(const e of t)for(const t of e.mutations)t instanceof Ri&&null===n.get(t.key)&&(r=r.add(t.key));let s=n;return this.Xe.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(s=s.insert(e,t))}),s))}}class Ih{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$n=n,this.On=r}static Mn(e,t){let n=Yi(),r=Yi();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Ih(e,t.fromCache,n,r)}}class _h{Fn(e){this.Ln=e}getDocumentsMatchingQuery(t,r,s,i){return 0===(e=r).filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||s.isEqual(Gr.min())?this.Bn(t,r):this.Ln.Sn(t,i).next(e=>{const n=this.Un(r,e);return(Ys(r)||Xs(r))&&this.qn(r.limitType,n,i,s)?this.Bn(t,r):(Tr()<=l.DEBUG&&Er("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),oi(r)),this.Ln.getDocumentsMatchingQuery(t,r,s).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))});var e}Un(n,e){let r=new $i(hi(n));return e.forEach((e,t)=>{ai(n,t)&&(r=r.add(t))}),r}qn(e,t,n,r){if(n.size!==t.size)return!0;const s="F"===e?t.last():t.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}Bn(e,t){return Tr()<=l.DEBUG&&Er("QueryEngine","Using full collection scan to execute query:",oi(t)),this.Ln.getDocumentsMatchingQuery(e,t,Gr.min())}}class Sh{constructor(e,t,n,r){this.persistence=e,this.Kn=t,this.O=r,this.jn=new Bi(Br),this.Qn=new ah(e=>ks(e),xs),this.Wn=Gr.min(),this.bn=e.getMutationQueue(n),this.Gn=e.getRemoteDocumentCache(),this.Ye=e.getTargetCache(),this.zn=new Eh(this.Gn,this.bn,this.persistence.getIndexManager()),this.Ze=e.getBundleCache(),this.Kn.Fn(this.zn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.jn))}}function Ah(e,t,n,r){return new Sh(e,t,n,r)}async function Dh(e,t){const n=e;let r=n.bn,o=n.zn;var s=await n.persistence.runTransaction("Handle user change","readonly",s=>{let i;return n.bn.getAllMutationBatches(s).next(e=>(i=e,r=n.persistence.getMutationQueue(t),o=new Eh(n.Gn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(s))).next(e=>{const t=[],n=[];let r=Yi();for(const s of i){t.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}for(const s of e){n.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}return o.Sn(s,r).next(e=>({Hn:e,removedBatchIds:t,addedBatchIds:n}))})});return n.bn=r,n.zn=o,n.Kn.Fn(n.zn),s}function Ch(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ye.getLastRemoteSnapshotVersion(e))}function Nh(e,c){const u=e,l=c.snapshotVersion;let d=u.jn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const e=u.Gn.newChangeBuffer({trackRemovals:!0});d=u.jn;const h=[];c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){h.push(u.Ye.removeMatchingKeys(a,t.removedDocuments,n).next(()=>u.Ye.addMatchingKeys(a,t.addedDocuments,n)));let e=r.withSequenceNumber(a.currentSequenceNumber);var s,i,o;c.targetMismatches.has(n)?e=e.withResumeToken(es.EMPTY_BYTE_STRING,Gr.min()).withLastLimboFreeSnapshotVersion(Gr.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),s=r,i=e,o=t,0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||h.push(u.Ye.updateTargetData(a,e))}});let t=zi;if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&h.push(u.persistence.referenceDelegate.updateLimboDocument(a,e))}),h.push(kh(a,e,c.documentUpdates).next(e=>{t=e})),!l.isEqual(Gr.min())){const c=u.Ye.getLastRemoteSnapshotVersion(a).next(e=>u.Ye.setTargetsMetadata(a,a.currentSequenceNumber,l));h.push(c)}return aa.waitFor(h).next(()=>e.apply(a)).next(()=>u.zn.Dn(a,t)).next(()=>t)}).then(e=>(u.jn=d,e))}function kh(e,i,t){let n=Yi();return t.forEach(e=>n=n.add(e)),i.getEntries(e,n).next(r=>{let s=zi;return t.forEach((e,t)=>{const n=r.get(e);t.isNoDocument()&&t.version.isEqual(Gr.min())?(i.removeEntry(e,t.readTime),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(i.addEntry(t),s=s.insert(e,t)):Er("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),s})}function xh(e,r){const s=e;return s.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return s.Ye.getTargetData(t,r).next(e=>e?(n=e,aa.resolve(n)):s.Ye.allocateTargetId(t).next(e=>(n=new Ta(r,e,0,t.currentSequenceNumber),s.Ye.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=s.jn.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(s.jn=s.jn.insert(e.targetId,e),s.Qn.set(r,e.targetId)),e})}async function Rh(e,t,n){const r=e,s=r.jn.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!da(e))throw e;Er("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.jn=r.jn.remove(t),r.Qn.delete(s.target)}function Lh(e,n,r){const s=e;let i=Gr.min(),o=Yi();return s.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,s=r.Qn.get(n);return void 0!==s?aa.resolve(r.jn.get(s)):r.Ye.getTargetData(t,n)}(s,t,ni(n)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Ye.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>s.Kn.getDocumentsMatchingQuery(t,n,r?i:Gr.min(),r?o:Yi())).next(e=>({documents:e,Jn:o})))}function Oh(e,t){const n=e,r=n.Ye,s=n.jn.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function Mh(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let s=zi,i=Sa(n);const o=dh(t),a=IDBKeyRange.lowerBound(i,!0);return o.Wt({index:zo.readTimeIndex,range:a},(e,t)=>{var n=Ia(r.O,t);s=s.insert(n.key,n),i=t.readTime}).next(()=>({Rn:s,readTime:Aa(i)}))}(n.Gn,e,n.Wn)).then(({Rn:e,readTime:t})=>(n.Wn=t,e))}class Ph{constructor(e){this.O=e,this.ts=new Map,this.es=new Map}getBundleMetadata(e,t){return aa.resolve(this.ts.get(t))}saveBundleMetadata(e,t){return this.ts.set(t.id,{id:t.id,version:t.version,createTime:fo(t.createTime)}),aa.resolve()}getNamedQuery(e,t){return aa.resolve(this.es.get(t))}saveNamedQuery(e,t){return this.es.set(t.name,{name:(t=t).name,query:Ra(t.bundledQuery),readTime:fo(t.readTime)}),aa.resolve()}}class Fh{constructor(){this.ns=new $i(Vh.ss),this.rs=new $i(Vh.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){var n=new Vh(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}cs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.us(new Vh(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new ds(new Yr([])),n=new Vh(t,e),r=new Vh(t,e+1),s=[];return this.rs.forEachInRange([n,r],e=>{this.us(e),s.push(e.key)}),s}fs(){this.ns.forEach(e=>this.us(e))}us(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){var t=new ds(new Yr([])),n=new Vh(t,e),t=new Vh(t,e+1);let r=Yi();return this.rs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new Vh(e,0),t=this.ns.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class Vh{constructor(e,t){this.key=e,this.ws=t}static ss(e,t){return ds.comparator(e.key,t.key)||Br(e.ws,t.ws)}static os(e,t){return Br(e.ws,t.ws)||ds.comparator(e.key,t.key)}}class qh{constructor(e,t){this.Xt=e,this.referenceDelegate=t,this.bn=[],this._s=1,this.gs=new $i(Vh.ss)}checkEmpty(e){return aa.resolve(0===this.bn.length)}addMutationBatch(e,t,n,r){var s=this._s;this._s++,0<this.bn.length&&this.bn[this.bn.length-1];var i=new wa(s,t,n,r);this.bn.push(i);for(const t of r)this.gs=this.gs.add(new Vh(t.key,s)),this.Xt.addToCollectionParentIndex(e,t.key.path.popLast());return aa.resolve(i)}lookupMutationBatch(e,t){return aa.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.ps(t+1),n=n<0?0:n;return aa.resolve(this.bn.length>n?this.bn[n]:null)}getHighestUnacknowledgedBatchId(){return aa.resolve(0===this.bn.length?-1:this._s-1)}getAllMutationBatches(e){return aa.resolve(this.bn.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Vh(t,0),r=new Vh(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([n,r],e=>{var t=this.ys(e.ws);s.push(t)}),aa.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $i(Br);return t.forEach(e=>{var t=new Vh(e,0),n=new Vh(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,n],e=>{r=r.add(e.ws)})}),aa.resolve(this.Ts(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;ds.isDocumentKey(s)||(s=s.child(""));var i=new Vh(new ds(s),0);let o=new $i(Br);return this.gs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.ws)),!0)},i),aa.resolve(this.Ts(o))}Ts(e){const n=[];return e.forEach(e=>{var t=this.ys(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){Dr(0===this.Es(r.batchId,"removed")),this.bn.shift();let s=this.gs;return aa.forEach(r.mutations,e=>{var t=new Vh(e.key,r.batchId);return s=s.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.gs=s})}se(e){}containsKey(e,t){var n=new Vh(t,0),n=this.gs.firstAfterOrEqual(n);return aa.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.bn.length,aa.resolve()}Es(e,t){return this.ps(e)}ps(e){return 0===this.bn.length?0:e-this.bn[0].batchId}ys(e){var t=this.ps(e);return t<0||t>=this.bn.length?null:this.bn[t]}}class Uh{constructor(e,t){this.Xt=e,this.Is=t,this.docs=new Bi(ds.comparator),this.size=0}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.Is(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.Xt.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return aa.resolve(n?n.document.mutableCopy():Ds.newInvalidDocument(t))}getEntries(e,t){let n=zi;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ds.newInvalidDocument(e))}),aa.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=zi;const s=new ds(t.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:e,value:{document:s}}=i.getNext();if(!t.path.isPrefixOf(e.path))break;s.readTime.compareTo(n)<=0||ai(t,s)&&(r=r.insert(s.key,s.mutableCopy()))}return aa.resolve(r)}As(e,t){return aa.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Bh(this)}getSize(e){return aa.resolve(this.size)}}class Bh extends hh{constructor(e){super(),this.Ne=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Ne.addEntry(n,t)):this.Ne.removeEntry(e)}),aa.waitFor(r)}getFromCache(e,t){return this.Ne.getEntry(e,t)}getAllFromCache(e,t){return this.Ne.getEntries(e,t)}}class jh{constructor(e){this.persistence=e,this.Rs=new ah(e=>ks(e),xs),this.lastRemoteSnapshotVersion=Gr.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Fh,this.targetCount=0,this.vs=Qa.oe()}forEachTarget(e,n){return this.Rs.forEach((e,t)=>n(t)),aa.resolve()}getLastRemoteSnapshotVersion(e){return aa.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return aa.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),aa.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),aa.resolve()}he(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new Qa(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.he(t),this.targetCount+=1,aa.resolve()}updateTargetData(e,t){return this.he(t),aa.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),--this.targetCount,aa.resolve()}removeTargets(n,r,s){let i=0;const o=[];return this.Rs.forEach((e,t)=>{t.sequenceNumber<=r&&null===s.get(t.targetId)&&(this.Rs.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),i++)}),aa.waitFor(o).next(()=>i)}getTargetCount(e){return aa.resolve(this.targetCount)}getTargetData(e,t){var n=this.Rs.get(t)||null;return aa.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.cs(t,n),aa.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),aa.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),aa.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Ps.ds(t);return aa.resolve(n)}containsKey(e,t){return aa.resolve(this.Ps.containsKey(t))}}class Kh{constructor(e,t){var n;this.Vs={},this.qe=new qr(0),this.Ke=!1,this.Ke=!0,this.referenceDelegate=e(this),this.Ye=new jh(this),this.Xt=new Pa,this.Xe=(n=this.Xt,e=e=>this.referenceDelegate.Ss(e),new Uh(n,e)),this.O=new Ea(t),this.Ze=new Ph(this.O)}start(){return Promise.resolve()}shutdown(){return this.Ke=!1,Promise.resolve()}get started(){return this.Ke}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Xt}getMutationQueue(e){let t=this.Vs[e.toKey()];return t||(t=new qh(this.Xt,this.referenceDelegate),this.Vs[e.toKey()]=t),t}getTargetCache(){return this.Ye}getRemoteDocumentCache(){return this.Xe}getBundleCache(){return this.Ze}runTransaction(e,t,n){Er("MemoryPersistence","Starting transaction:",e);const r=new $h(this.qe.next());return this.referenceDelegate.Ds(),n(r).next(e=>this.referenceDelegate.Cs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ns(t,n){return aa.or(Object.values(this.Vs).map(e=>()=>e.containsKey(t,n)))}}class $h extends oa{constructor(e){super(),this.currentSequenceNumber=e}}class Gh{constructor(e){this.persistence=e,this.ks=new Fh,this.xs=null}static $s(e){return new Gh(e)}get Os(){if(this.xs)return this.xs;throw Ar()}addReference(e,t,n){return this.ks.addReference(n,t),this.Os.delete(n.toString()),aa.resolve()}removeReference(e,t,n){return this.ks.removeReference(n,t),this.Os.add(n.toString()),aa.resolve()}markPotentiallyOrphaned(e,t){return this.Os.add(t.toString()),aa.resolve()}removeTarget(e,t){this.ks.ls(t.targetId).forEach(e=>this.Os.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Os.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ds(){this.xs=new Set}Cs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return aa.forEach(this.Os,e=>{const t=ds.fromPath(e);return this.Ms(n,t).next(e=>{e||r.removeEntry(t,Gr.min())})}).next(()=>(this.xs=null,r.apply(n)))}updateLimboDocument(e,t){return this.Ms(e,t).next(e=>{e?this.Os.delete(t.toString()):this.Os.add(t.toString())})}Ss(e){return 0}Ms(e,t){return aa.or([()=>aa.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}function zh(e,t){return`firestore_clients_${e}_${t}`}function Wh(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Hh(e,t){return`firestore_targets_${e}_${t}`}class Qh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Fs(e,t,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new Nr(r.error.code,r.error.message))),i?new Qh(e,t,r.state,s):(Ir("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ls(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Yh{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Fs(e,t){var n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new Nr(n.error.code,n.error.message))),s?new Yh(e,n.state,r):(Ir("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ls(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Fs(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Xi;for(let i=0;r&&i<n.activeTargetIds.length;++i)r=ls(n.activeTargetIds[i]),s=s.add(n.activeTargetIds[i]);return r?new Xh(e,s):(Ir("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Jh{constructor(e,t){this.clientId=e,this.onlineState=t}static Fs(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Jh(t.clientId,t.onlineState):(Ir("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Zh{constructor(){this.activeTargetIds=Xi}Bs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ls(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ec{constructor(e,t,n,r,s){this.window=e,this.Le=t,this.persistenceKey=n,this.qs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ks=this.js.bind(this),this.Qs=new Bi(Br),this.started=!1,this.Ws=[];var i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Gs=zh(this.persistenceKey,this.qs),this.zs=`firestore_sequence_number_${this.persistenceKey}`,this.Qs=this.Qs.insert(this.qs,new Zh),this.Hs=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Js=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.Ys=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.Xs=`firestore_online_state_${this.persistenceKey}`,this.Zs=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.Ks)}static Vt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.In();for(const n of e)if(n!==this.qs){const e=this.getItem(zh(this.persistenceKey,n));var t;!e||(t=Xh.Fs(n,e))&&(this.Qs=this.Qs.insert(t.clientId,t))}this.ti();const n=this.storage.getItem(this.Xs);if(n){const e=this.ei(n);e&&this.ni(e)}for(const e of this.Ws)this.js(e);this.Ws=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.zs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.si(this.Qs)}isActiveQueryTarget(n){let r=!1;return this.Qs.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.ii(e,"pending")}updateMutationState(e,t,n){this.ii(e,t,n),this.ri(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(Hh(this.persistenceKey,e)))||(n=Yh.Fs(e,n))&&(t=n.state)),this.oi.Bs(e),this.ti(),t}removeLocalQueryTarget(e){this.oi.Us(e),this.ti()}isLocalQueryTarget(e){return this.oi.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Hh(this.persistenceKey,e))}updateQueryState(e,t,n){this.ci(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ri(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ai(e)}notifyBundleLoaded(){this.ui()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ks),this.removeItem(this.Gs),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return Er("SharedClientState","READ",e,t),t}setItem(e,t){Er("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Er("SharedClientState","REMOVE",e),this.storage.removeItem(e)}js(e){const r=e;r.storageArea===this.storage&&(Er("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.Gs?this.Le.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Hs.test(r.key)){if(null==r.newValue){var e=this.hi(r.key);return this.li(e,null)}e=this.fi(r.key,r.newValue);if(e)return this.li(e.clientId,e)}else if(this.Js.test(r.key)){if(null!==r.newValue){var t=this.di(r.key,r.newValue);if(t)return this.wi(t)}}else if(this.Ys.test(r.key)){if(null!==r.newValue){t=this._i(r.key,r.newValue);if(t)return this.mi(t)}}else if(r.key===this.Xs){if(null!==r.newValue){var n=this.ei(r.newValue);if(n)return this.ni(n)}}else if(r.key===this.zs){n=function(e){let t=qr.I;if(null!=e)try{var n=JSON.parse(e);Dr("number"==typeof n),t=n}catch(e){Ir("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue);n!==qr.I&&this.sequenceNumberHandler(n)}else if(r.key===this.Zs)return this.syncEngine.gi()}else this.Ws.push(r)}):Ir("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get oi(){return this.Qs.get(this.qs)}ti(){this.setItem(this.Gs,this.oi.Ls())}ii(e,t,n){const r=new Qh(this.currentUser,e,t,n),s=Wh(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Ls())}ri(e){var t=Wh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}ai(e){var t={clientId:this.qs,onlineState:e};this.storage.setItem(this.Xs,JSON.stringify(t))}ci(e,t,n){const r=Hh(this.persistenceKey,e),s=new Yh(e,t,n);this.setItem(r,s.Ls())}ui(){this.setItem(this.Zs,"value-not-used")}hi(e){var t=this.Hs.exec(e);return t?t[1]:null}fi(e,t){var n=this.hi(e);return Xh.Fs(n,t)}di(e,t){var n=this.Js.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Qh.Fs(new vr(n),r,t)}_i(e,t){var n=this.Ys.exec(e),n=Number(n[1]);return Yh.Fs(n,t)}ei(e){return Jh.Fs(e)}async wi(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.yi(e.batchId,e.state,e.error);Er("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}mi(e){return this.syncEngine.pi(e.targetId,e.state,e.error)}li(e,t){const n=t?this.Qs.insert(e,t):this.Qs.remove(e),r=this.si(this.Qs),s=this.si(n),i=[],o=[];return s.forEach(e=>{r.has(e)||i.push(e)}),r.forEach(e=>{s.has(e)||o.push(e)}),this.syncEngine.Ti(i,o).then(()=>{this.Qs=n})}ni(e){this.Qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}si(e){let n=Xi;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class tc{constructor(){this.Ei=new Zh,this.Ii={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ei.Bs(e),this.Ii[e]||"not-current"}updateQueryState(e,t,n){this.Ii[e]=t}removeLocalQueryTarget(e){this.Ei.Us(e)}isLocalQueryTarget(e){return this.Ei.activeTargetIds.has(e)}clearQueryState(e){delete this.Ii[e]}getAllActiveQueryTargets(){return this.Ei.activeTargetIds}isActiveQueryTarget(e){return this.Ei.activeTargetIds.has(e)}start(){return this.Ei=new Zh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class nc{Ai(e){}shutdown(){}}class rc{constructor(){this.Ri=()=>this.bi(),this.Pi=()=>this.vi(),this.Vi=[],this.Si()}Ai(e){this.Vi.push(e)}shutdown(){window.removeEventListener("online",this.Ri),window.removeEventListener("offline",this.Pi)}Si(){window.addEventListener("online",this.Ri),window.addEventListener("offline",this.Pi)}bi(){Er("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Vi)e(0)}vi(){Er("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Vi)e(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const sc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class ic{constructor(e){this.Di=e.Di,this.Ci=e.Ci}Ni(e){this.ki=e}xi(e){this.$i=e}onMessage(e){this.Oi=e}close(){this.Ci()}send(e){this.Di(e)}Mi(){this.ki()}Fi(e){this.$i(e)}Li(e){this.Oi(e)}}class oc extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.Bi=t+"://"+e.host,this.Ui="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}qi(t,e,n,r,s){const i=this.Ki(t,e);Er("RestConnection","Sending: ",i,n);var o={};return this.ji(o,r,s),this.Qi(t,i,o,n).then(e=>(Er("RestConnection","Received: ",e),e),e=>{throw _r("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Wi(e,t,n,r,s){return this.qi(e,t,n,r,s)}ji(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+wr,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}Ki(e,t){var n=sc[e];return`${this.Bi}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Qi(a,t,n,r){return new Promise((s,i)=>{const o=new pr;o.listenOnce(ur.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case cr.NO_ERROR:var e=o.getResponseJson();Er("Connection","XHR received:",JSON.stringify(e)),s(e);break;case cr.TIMEOUT:Er("Connection",'RPC "'+a+'" timed out'),i(new Nr(Cr.DEADLINE_EXCEEDED,"Request time out"));break;case cr.HTTP_ERROR:var t,n=o.getStatus();if(Er("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(Cr).indexOf(r)?r:Cr.UNKNOWN,i(new Nr(t,a.message))):i(new Nr(Cr.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Nr(Cr.UNAVAILABLE,"Connection failed."));break;default:Ar()}}finally{Er("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}Gi(e,t,n){const r=[this.Bi,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new nr,i=hr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new gr({})),this.ji(o.initMessageHeaders,t,n),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=f().indexOf("Electron/")||function(){const e=f();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}()||0<=f().indexOf("MSAppHost/")||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||(o.httpHeadersOverwriteParam="$httpHeaders");var a=r.join("");Er("Connection","Creating WebChannel: "+a,o);const h=s.createWebChannel(a,o);let c=!1,u=!1;const l=new ic({Di:e=>{u?Er("Connection","Not sending because WebChannel is closed:",e):(c||(Er("Connection","Opening WebChannel transport."),h.open(),c=!0),Er("Connection","WebChannel sending:",e),h.send(e))},Ci:()=>h.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(h,mr.EventType.OPEN,()=>{u||Er("Connection","WebChannel transport opened.")}),d(h,mr.EventType.CLOSE,()=>{u||(u=!0,Er("Connection","WebChannel transport closed"),l.Fi())}),d(h,mr.EventType.ERROR,e=>{u||(u=!0,_r("Connection","WebChannel transport errored:",e),l.Fi(new Nr(Cr.UNAVAILABLE,"The operation could not be completed")))}),d(h,mr.EventType.MESSAGE,n=>{if(!u){var e=n.data[0];Dr(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){Er("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=ar[e];if(void 0!==t)return Ui(t)}(n),t=r.message;void 0===e&&(e=Cr.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),u=!0,l.Fi(new Nr(e,t)),h.close()}else Er("Connection","WebChannel received:",e),l.Li(e)}}),d(i,lr.STAT_EVENT,e=>{e.stat===dr?Er("Connection","Detected buffering proxy"):e.stat===fr&&Er("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.Mi()},0),l}}function ac(){return"undefined"!=typeof window?window:null}function hc(){return"undefined"!=typeof document?document:null}function cc(e){return new co(e,!0)}class uc{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Le=e,this.timerId=t,this.zi=n,this.Hi=r,this.Ji=s,this.Yi=0,this.Xi=null,this.Zi=Date.now(),this.reset()}reset(){this.Yi=0}tr(){this.Yi=this.Ji}er(e){this.cancel();var t=Math.floor(this.Yi+this.nr()),n=Math.max(0,Date.now()-this.Zi),r=Math.max(0,t-n);0<r&&Er("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Yi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Xi=this.Le.enqueueAfterDelay(this.timerId,r,()=>(this.Zi=Date.now(),e())),this.Yi*=this.Hi,this.Yi<this.zi&&(this.Yi=this.zi),this.Yi>this.Ji&&(this.Yi=this.Ji)}sr(){null!==this.Xi&&(this.Xi.skipDelay(),this.Xi=null)}cancel(){null!==this.Xi&&(this.Xi.cancel(),this.Xi=null)}nr(){return(Math.random()-.5)*this.Yi}}class lc{constructor(e,t,n,r,s,i,o,a){this.Le=e,this.ir=n,this.rr=r,this.cr=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.ar=0,this.ur=null,this.hr=null,this.stream=null,this.lr=new uc(e,t)}dr(){return 1===this.state||5===this.state||this.wr()}wr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this._r()}async stop(){this.dr()&&await this.close(0)}mr(){this.state=0,this.lr.reset()}gr(){this.wr()&&null===this.ur&&(this.ur=this.Le.enqueueAfterDelay(this.ir,6e4,()=>this.yr()))}pr(e){this.Tr(),this.stream.send(e)}async yr(){if(this.wr())return this.close(0)}Tr(){this.ur&&(this.ur.cancel(),this.ur=null)}Er(){this.hr&&(this.hr.cancel(),this.hr=null)}async close(e,t){this.Tr(),this.Er(),this.lr.cancel(),this.ar++,4!==e?this.lr.reset():t&&t.code===Cr.RESOURCE_EXHAUSTED?(Ir(t.toString()),Ir("Using maximum backoff delay to prevent overloading the backend."),this.lr.tr()):t&&t.code===Cr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Ir(),this.stream.close(),this.stream=null),this.state=e,await this.listener.xi(t)}Ir(){}auth(){this.state=1;const e=this.Ar(this.ar),n=this.ar;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.ar===n&&this.Rr(e,t)},t=>{e(()=>{var e=new Nr(Cr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.br(e)})})}Rr(e,t){const n=this.Ar(this.ar);this.stream=this.Pr(e,t),this.stream.Ni(()=>{n(()=>(this.state=2,this.hr=this.Le.enqueueAfterDelay(this.rr,1e4,()=>(this.wr()&&(this.state=3),Promise.resolve())),this.listener.Ni()))}),this.stream.xi(e=>{n(()=>this.br(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}_r(){this.state=5,this.lr.er(async()=>{this.state=0,this.start()})}br(e){return Er("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ar(t){return e=>{this.Le.enqueueAndForget(()=>this.ar===t?e():(Er("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dc extends lc{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.O=s}Pr(e,t){return this.cr.Gi("Listen",e,t)}onMessage(e){this.lr.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:Ar(),s=t.targetChange.targetIds||[],i=(f=t.targetChange.resumeToken,e.k?(Dr(void 0===f||"string"==typeof f),es.fromBase64String(f||"")):(Dr(void 0===f||f instanceof Uint8Array),es.fromUint8Array(f||new Uint8Array))),o=t.targetChange.cause,a=o&&(a=void 0===(f=o).code?Cr.UNKNOWN:Ui(f.code),new Nr(a,f.message||""));n=new no(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;var h=t.documentChange;h.document,h.document.name,h.document.updateTime;var a=yo(e,h.document.name),c=fo(h.document.updateTime),u=new As({mapValue:{fields:h.document.fields}}),c=Ds.newFoundDocument(a,c,u),u=h.targetIds||[],h=h.removedTargetIds||[];n=new eo(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;h=yo(e,u.document),c=u.readTime?fo(u.readTime):Gr.min(),c=Ds.newNoDocument(h,c),u=u.removedTargetIds||[];n=new eo([],u,c.key,c)}else if("documentRemove"in t){t.documentRemove;var l=t.documentRemove;l.document;var d=yo(e,l.document),l=l.removedTargetIds||[];n=new eo([],l,d,null)}else{if(!("filter"in t))return Ar();{t.filter;const e=t.filter;e.targetId;l=e.count||0,d=new Vi(l),l=e.targetId;n=new to(l,d)}}var a,f;return n}(this.O,e),n=function(e){if(!("targetChange"in e))return Gr.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?fo(t.readTime):Gr.min()}(e);return this.listener.vr(t,n)}Vr(e){const t={};t.database=bo(this.O),t.addTarget=function(e,t){let n;var r=t.target;return n=Rs(r)?{documents:Ao(e,r)}:{query:Do(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=lo(e,t.resumeToken):0<t.snapshotVersion.compareTo(Gr.min())&&(n.readTime=uo(e,t.snapshotVersion.toTimestamp())),n}(this.O,e);var n,r,r=(this.O,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ar()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.pr(t)}Sr(e){const t={};t.database=bo(this.O),t.removeTarget=e,this.pr(t)}}class fc extends lc{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.O=s,this.Dr=!1}get Cr(){return this.Dr}start(){this.Dr=!1,this.lastStreamToken=void 0,super.start()}Ir(){this.Dr&&this.Nr([])}Pr(e,t){return this.cr.Gi("Write",e,t)}onMessage(e){if(Dr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Dr){this.lr.reset();var t=(r=e.writeResults,s=e.commitTime,r&&0<r.length?(Dr(void 0!==s),r.map(e=>function(e,t){let n=e.updateTime?fo(e.updateTime):fo(t);return n.isEqual(Gr.min())&&(n=fo(t)),new Ii(n,e.transformResults||[])}(e,s))):[]),n=fo(e.commitTime);return this.listener.kr(n,t)}var r,s;return Dr(!e.writeResults||0===e.writeResults.length),this.Dr=!0,this.listener.$r()}Or(){const e={};e.database=bo(this.O),this.pr(e)}Nr(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>_o(this.O,e))};this.pr(t)}}class gc extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.cr=n,this.O=r,this.Mr=!1}Fr(){if(this.Mr)throw new Nr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")}qi(n,r,s){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.cr.qi(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Cr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Nr(Cr.UNKNOWN,e.toString())})}Wi(n,r,s){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.cr.Wi(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===Cr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Nr(Cr.UNKNOWN,e.toString())})}terminate(){this.Mr=!0}}class mc{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Lr=0,this.Br=null,this.Ur=!0}qr(){0===this.Lr&&(this.Kr("Unknown"),this.Br=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Br=null,this.jr("Backend didn't respond within 10 seconds."),this.Kr("Offline"),Promise.resolve())))}Qr(e){"Online"===this.state?this.Kr("Unknown"):(this.Lr++,1<=this.Lr&&(this.Wr(),this.jr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Kr("Offline")))}set(e){this.Wr(),this.Lr=0,"Online"===e&&(this.Ur=!1),this.Kr(e)}Kr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}jr(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Ur?(Ir(t),this.Ur=!1):Er("OnlineStateTracker",t)}Wr(){null!==this.Br&&(this.Br.cancel(),this.Br=null)}}class pc{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Gr=[],this.zr=new Map,this.Hr=new Set,this.Jr=[],this.Yr=s,this.Yr.Ai(e=>{n.enqueueAndForget(async()=>{Sc(this)&&(Er("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Hr.add(4),await vc(t),t.Xr.set("Unknown"),t.Hr.delete(4),await yc(t)}(this))})}),this.Xr=new mc(n,r)}}async function yc(e){if(Sc(e))for(const t of e.Jr)await t(!0)}async function vc(e){for(const t of e.Jr)await t(!1)}function wc(e,t){const n=e;n.zr.has(t.targetId)||(n.zr.set(t.targetId,t),_c(n)?Ic(n):Oc(n).wr()&&Tc(n,t))}function bc(e,t){const n=e,r=Oc(n);n.zr.delete(t),r.wr()&&Ec(n,t),0===n.zr.size&&(r.wr()?r.gr():Sc(n)&&n.Xr.set("Unknown"))}function Tc(e,t){e.Zr.tt(t.targetId),Oc(e).Vr(t)}function Ec(e,t){e.Zr.tt(t),Oc(e).Sr(t)}function Ic(t){t.Zr=new so({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.zr.get(e)||null}),Oc(t).start(),t.Xr.qr()}function _c(e){return Sc(e)&&!Oc(e).dr()&&0<e.zr.size}function Sc(e){return 0===e.Hr.size}function Ac(e){e.Zr=void 0}async function Dc(e,t,n){if(!da(t))throw t;e.Hr.add(1),await vc(e),e.Xr.set("Offline"),n=n||(()=>Ch(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Er("RemoteStore","Retrying IndexedDB access"),await n(),e.Hr.delete(1),await yc(e)})}function Cc(t,n){return n().catch(e=>Dc(t,e,n))}async function Nc(e){const t=e,n=Mc(t);let r=0<t.Gr.length?t.Gr[t.Gr.length-1].batchId:-1;for(;Sc(s=t)&&s.Gr.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.bn.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Gr.length&&n.gr();break}r=e.batchId,function(e,t){e.Gr.push(t);const n=Mc(e);n.wr()&&n.Cr&&n.Nr(t.mutations)}(t,e)}catch(e){await Dc(t,e)}var s;kc(t)&&xc(t)}function kc(e){return Sc(e)&&!Mc(e).dr()&&0<e.Gr.length}function xc(e){Mc(e).start()}async function Rc(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),Er("RemoteStore","RemoteStore received new credentials");var r=Sc(n);n.Hr.add(3),await vc(n),r&&n.Xr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Hr.delete(3),await yc(n)}async function Lc(e,t){const n=e;t?(n.Hr.delete(2),await yc(n)):(n.Hr.add(2),await vc(n),n.Xr.set("Unknown"))}function Oc(t){return t.eo||(t.eo=function(e,t,n){const r=e;return r.Fr(),new dc(t,r.cr,r.authCredentials,r.appCheckCredentials,r.O,n)}(t.datastore,t.asyncQueue,{Ni:(async function(n){n.zr.forEach((e,t)=>{Tc(n,e)})}).bind(null,t),xi:(async function(e,t){Ac(e),_c(e)?(e.Xr.Qr(t),Ic(e)):e.Xr.set("Unknown")}).bind(null,t),vr:(async function(e,r,t){if(e.Xr.set("Online"),r instanceof no&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.zr.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.zr.delete(n),e.Zr.removeTarget(n))}(e)}catch(t){Er("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await Dc(e,t)}else if(r instanceof eo?e.Zr.at(r):r instanceof to?e.Zr._t(r):e.Zr.lt(r),!t.isEqual(Gr.min()))try{const r=await Ch(e.localStore);0<=t.compareTo(r)&&await function(r,s){const e=r.Zr.Tt(s);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.zr.get(t);n&&r.zr.set(t,n.withResumeToken(e.resumeToken,s))}}),e.targetMismatches.forEach(e=>{const t=r.zr.get(e);var n;t&&(r.zr.set(e,t.withResumeToken(es.EMPTY_BYTE_STRING,t.snapshotVersion)),Ec(r,e),n=new Ta(t.target,e,1,t.sequenceNumber),Tc(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){Er("RemoteStore","Failed to raise snapshot:",r),await Dc(e,r)}}).bind(null,t)}),t.Jr.push(async e=>{e?(t.eo.mr(),_c(t)?Ic(t):t.Xr.set("Unknown")):(await t.eo.stop(),Ac(t))})),t.eo}function Mc(t){return t.no||(t.no=function(e,t,n){const r=e;return r.Fr(),new fc(t,r.cr,r.authCredentials,r.appCheckCredentials,r.O,n)}(t.datastore,t.asyncQueue,{Ni:(async function(e){Mc(e).Or()}).bind(null,t),xi:(async function(e,t){t&&Mc(e).Cr&&await async function(e,t){if(qi(n=t.code)&&n!==Cr.ABORTED){const n=e.Gr.shift();Mc(e).mr(),await Cc(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Nc(e)}var n}(e,t),kc(e)&&xc(e)}).bind(null,t),$r:(async function(e){const t=Mc(e);for(const n of e.Gr)t.Nr(n.mutations)}).bind(null,t),kr:(async function(e,t,n){const r=e.Gr.shift(),s=ba.from(r,t,n);await Cc(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await Nc(e)}).bind(null,t)}),t.Jr.push(async e=>{e?(t.no.mr(),await Nc(t)):(await t.no.stop(),0<t.Gr.length&&(Er("RemoteStore",`Stopping write stream with ${t.Gr.length} pending writes`),t.Gr=[]))})),t.no}class Pc{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new kr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new Pc(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Nr(Cr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fc(e,t){if(Ir("AsyncQueue",`${t}: ${e}`),da(e))return new Nr(Cr.UNAVAILABLE,`${t}: ${e}`);throw e}class Vc{constructor(n){this.comparator=n?(e,t)=>n(e,t)||ds.comparator(e.key,t.key):(e,t)=>ds.comparator(e.key,t.key),this.keyedMap=Wi,this.sortedSet=new Bi(this.comparator)}static emptySet(e){return new Vc(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Vc))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Vc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class qc{constructor(){this.so=new Bi(ds.comparator)}track(e){var t=e.doc.key,n=this.so.get(t);!n||0!==e.type&&3===n.type?this.so=this.so.insert(t,e):3===e.type&&1!==n.type?this.so=this.so.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.so=this.so.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.so=this.so.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.so=this.so.remove(t):1===e.type&&2===n.type?this.so=this.so.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.so=this.so.insert(t,{type:2,doc:e.doc}):Ar()}io(){const n=[];return this.so.inorderTraversal((e,t)=>{n.push(t)}),n}}class Uc{constructor(e,t,n,r,s,i,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Uc(e,t,Vc.emptySet(t),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&si(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Bc{constructor(){this.ro=void 0,this.listeners=[]}}class jc{constructor(){this.queries=new ah(e=>ii(e),si),this.onlineState="Unknown",this.oo=new Set}}async function Kc(e,t){const n=e,r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Bc),s)try{i.ro=await n.onListen(r)}catch(e){const n=Fc(e,`Initialization of query '${oi(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.co(n.onlineState),!i.ro||t.ao(i.ro)&&Gc(n)}async function $c(e,t){const n=e,r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);0<=e&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Gc(e){e.oo.forEach(e=>{e.next()})}class zc{constructor(e,t,n){this.query=e,this.uo=t,this.ho=!1,this.lo=null,this.onlineState="Unknown",this.options=n||{}}ao(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Uc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ho?this.fo(e)&&(this.uo.next(e),t=!0):this.wo(e,this.onlineState)&&(this._o(e),t=!0),this.lo=e,t}onError(e){this.uo.error(e)}co(e){this.onlineState=e;let t=!1;return this.lo&&!this.ho&&this.wo(this.lo,e)&&(this._o(this.lo),t=!0),t}wo(e,t){return!e.fromCache||!(this.options.mo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}fo(e){if(0<e.docChanges.length)return!0;var t=this.lo&&this.lo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}_o(e){e=Uc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ho=!0,this.uo.next(e)}}class Wc{constructor(e,t){this.payload=e,this.byteLength=t}yo(){return"metadata"in this.payload}}class Hc{constructor(e){this.O=e}Yn(e){return yo(this.O,e)}Xn(e){return e.metadata.exists?Io(this.O,e.document,!1):Ds.newNoDocument(this.Yn(e.metadata.name),this.Zn(e.metadata.readTime))}Zn(e){return fo(e)}}class Qc{constructor(e,t,n){this.po=e,this.localStore=t,this.O=n,this.queries=[],this.documents=[],this.progress=Yc(e)}To(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Eo(e){const t=new Map,n=new Hc(this.O);for(const s of e)if(s.metadata.queries){const e=n.Yn(s.metadata.name);for(const n of s.metadata.queries){var r=(t.get(n)||Yi()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=e;let i=Yi(),o=zi;for(const e of n){const n=t.Yn(e.metadata.name);e.document&&(i=i.add(n));const c=t.Xn(e);c.setReadTime(t.Zn(e.metadata.readTime)),o=o.insert(n,c)}const a=s.Gn.newChangeBuffer({trackRemovals:!0}),h=await xh(s,(r=r,ni(Qs(Yr.fromString(`__bundle__/docs/${r}`)))));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>kh(t,a,o).next(e=>(a.apply(t),e)).next(e=>s.Ye.removeMatchingKeysForTargetId(t,h.targetId).next(()=>s.Ye.addMatchingKeys(t,i,h.targetId)).next(()=>s.zn.Dn(t,e)).next(()=>e)))}(this.localStore,new Hc(this.O),this.documents,this.po.id),t=this.Eo(this.documents);for(const e of this.queries)await async function(e,n,r=Yi()){const s=await xh(e,ni(Ra(n.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",e=>{var t=fo(n.readTime);if(0<=s.snapshotVersion.compareTo(t))return i.Ze.saveNamedQuery(e,n);t=s.withResumeToken(es.EMPTY_BYTE_STRING,t);return i.jn=i.jn.insert(t.targetId,t),i.Ye.updateTargetData(e,t).next(()=>i.Ye.removeMatchingKeysForTargetId(e,s.targetId)).next(()=>i.Ye.addMatchingKeys(e,r,s.targetId)).next(()=>i.Ze.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new Th(Object.assign({},this.progress),e)}}function Yc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Xc{constructor(e){this.key=e}}class Jc{constructor(e){this.key=e}}class Zc{constructor(e,t){this.query=e,this.Io=t,this.Ao=null,this.current=!1,this.Ro=Yi(),this.mutatedKeys=Yi(),this.bo=hi(e),this.Po=new Vc(this.bo)}get vo(){return this.Io}Vo(e,t){const a=t?t.So:new qc,h=(t||this).Po;let c=(t||this).mutatedKeys,u=h,l=!1;const d=Ys(this.query)&&h.size===this.query.limit?h.last():null,f=Xs(this.query)&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal((e,t)=>{const n=h.get(e),r=ai(this.query,t)?t:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(a.track({type:3,doc:r}),o=!0):this.Do(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.bo(r,d)||f&&this.bo(r,f)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(l=!0)),o&&(c=r?(u=u.add(r),i?c.add(e):c.delete(e)):(u=u.delete(e),c.delete(e)))}),Ys(this.query)||Xs(this.query))for(;u.size>this.query.limit;){const e=Ys(this.query)?u.last():u.first();u=u.delete(e.key),c=c.delete(e.key),a.track({type:1,doc:e})}return{Po:u,So:a,qn:l,mutatedKeys:c}}Do(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Po;this.Po=e.Po,this.mutatedKeys=e.mutatedKeys;const s=e.So.io();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ar()}};return n(e)-n(t)}(e.type,t.type)||this.bo(e.doc,t.doc)),this.Co(n);var i=t?this.No():[],o=0===this.Ro.size&&this.current?1:0,a=o!==this.Ao;return this.Ao=o,0!==s.length||a?{snapshot:new Uc(this.query,e.Po,r,s,e.mutatedKeys,0==o,a,!1),ko:i}:{ko:i}}co(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Po:this.Po,So:new qc,mutatedKeys:this.mutatedKeys,qn:!1},!1)):{ko:[]}}xo(e){return!this.Io.has(e)&&!!this.Po.has(e)&&!this.Po.get(e).hasLocalMutations}Co(e){e&&(e.addedDocuments.forEach(e=>this.Io=this.Io.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Io=this.Io.delete(e)),this.current=e.current)}No(){if(!this.current)return[];const t=this.Ro;this.Ro=Yi(),this.Po.forEach(e=>{this.xo(e.key)&&(this.Ro=this.Ro.add(e.key))});const n=[];return t.forEach(e=>{this.Ro.has(e)||n.push(new Jc(e))}),this.Ro.forEach(e=>{t.has(e)||n.push(new Xc(e))}),n}$o(e){this.Io=e.Jn,this.Ro=Yi();var t=this.Vo(e.documents);return this.applyChanges(t,!0)}Oo(){return Uc.fromInitialDocuments(this.query,this.Po,this.mutatedKeys,0===this.Ao)}}class eu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class tu{constructor(e){this.key=e,this.Mo=!1}}class nu{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Fo={},this.Lo=new ah(e=>ii(e),si),this.Bo=new Map,this.Uo=new Set,this.qo=new Bi(ds.comparator),this.Ko=new Map,this.jo=new Fh,this.Qo={},this.Wo=new Map,this.Go=Qa.ce(),this.onlineState="Unknown",this.zo=void 0}get isPrimaryClient(){return!0===this.zo}}async function ru(n,e,t,r){n.Ho=(e,i,t)=>async function(e,t,n){let r=t.view.Vo(i);r.qn&&(r=await Lh(e.localStore,t.query,!1).then(({documents:e})=>t.view.Vo(e,r)));var s=n&&n.targetChanges.get(t.targetId),s=t.view.applyChanges(r,e.isPrimaryClient,s);return du(e,t.targetId,s.ko),s.snapshot}(n,e,t);const s=await Lh(n.localStore,e,!0),i=new Zc(e,s.Jn),o=i.Vo(s.documents),a=Zi.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),h=i.applyChanges(o,n.isPrimaryClient,a);du(n,t,h.ko);var c=new eu(e,t,i);return n.Lo.set(e,c),n.Bo.has(t)?n.Bo.get(t).push(e):n.Bo.set(t,[e]),h.snapshot}async function su(e,t,n){const r=wu(e);try{const e=await function(e,r){const s=e,i=$r.now(),t=r.reduce((e,t)=>e.add(t.key),Yi());let o;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>s.zn.Sn(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=fi(r.transform,e||null);null!=s&&(null==n&&(n=As.empty()),n.set(r.field,s))}return n||null}(n,o.get(n.key));null!=r&&t.push(new Ri(n.key,r,function r(e){const s=[];return Wr(e.fields,(e,t)=>{const n=new Jr([e]);if(_s(t)){const e=r(t.mapValue).fields;if(0===e.length)s.push(n);else for(const t of e)s.push(n.child(t))}else s.push(n)}),new Zr(s)}(r.value.mapValue),_i.exists(!0)))}return s.bn.addMutationBatch(n,i,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Qo[e.currentUser.toKey()];r=r||new Bi(Br),r=r.insert(t,n),e.Qo[e.currentUser.toKey()]=r}(r,e.batchId,n),await gu(r,e.changes),await Nc(r.remoteStore)}catch(e){const t=Fc(e,"Failed to persist write");n.reject(t)}}async function iu(e,t){const r=e;try{const e=await Nh(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Ko.get(t);n&&(Dr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Mo=!0:0<e.modifiedDocuments.size?Dr(n.Mo):0<e.removedDocuments.size&&(Dr(n.Mo),n.Mo=!1))}),await gu(r,e,t)}catch(e){await eh(e)}}function ou(r,s,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.Lo.forEach((e,t)=>{var n=t.view.co(s);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.co(n)&&(r=!0)}),r&&Gc(t)}(t.eventManager,s),r.length&&t.Fo.vr(r),t.onlineState=s,t.isPrimaryClient&&t.sharedClientState.setOnlineState(s)}}async function au(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=s.Gn.newChangeBuffer({trackRemovals:!0});return function(e,t,r,s){const i=r.batch,n=i.keys();let o=aa.resolve();return n.forEach(n=>{o=o.next(()=>s.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);Dr(null!==t),e.version.compareTo(t)<0&&(i.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),s.addEntry(e)))})}),o.next(()=>e.bn.removeMutationBatch(t,i))}(s,e,r,n).next(()=>n.apply(e)).next(()=>s.bn.performConsistencyCheck(e)).next(()=>s.zn.Sn(e,t))})}(n.localStore,t);cu(n,r,null),hu(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await gu(n,e)}catch(e){await eh(e)}}function hu(e,t){(e.Wo.get(t)||[]).forEach(e=>{e.resolve()}),e.Wo.delete(t)}function cu(e,t,n){const r=e;let s=r.Qo[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Qo[r.currentUser.toKey()]=s}}function uu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Bo.get(e))t.Lo.delete(r),n&&t.Fo.Jo(r,n);t.Bo.delete(e),t.isPrimaryClient&&t.jo.ls(e).forEach(e=>{t.jo.containsKey(e)||lu(t,e)})}function lu(e,t){e.Uo.delete(t.path.canonicalString());var n=e.qo.get(t);null!==n&&(bc(e.remoteStore,n),e.qo=e.qo.remove(t),e.Ko.delete(n),fu(e))}function du(e,t,n){for(const r of n)r instanceof Xc?(e.jo.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.qo.get(n)||e.Uo.has(r)||(Er("SyncEngine","New document in limbo: "+n),e.Uo.add(r),fu(e))}(e,r)):r instanceof Jc?(Er("SyncEngine","Document no longer in limbo: "+r.key),e.jo.removeReference(r.key,t),e.jo.containsKey(r.key)||lu(e,r.key)):Ar()}function fu(e){for(;0<e.Uo.size&&e.qo.size<e.maxConcurrentLimboResolutions;){var t=e.Uo.values().next().value;e.Uo.delete(t);var n=new ds(Yr.fromString(t)),t=e.Go.next();e.Ko.set(t,new tu(n)),e.qo=e.qo.insert(n,t),wc(e.remoteStore,new Ta(ni(Qs(n.path)),t,2,qr.I))}}async function gu(e,t,r){const s=e,i=[],o=[],a=[];s.Lo.isEmpty()||(s.Lo.forEach((e,n)=>{a.push(s.Ho(n,t,r).then(e=>{var t;e&&(s.isPrimaryClient&&s.sharedClientState.updateQueryState(n.targetId,e.fromCache?"not-current":"current"),i.push(e),t=Ih.Mn(n.targetId,e),o.push(t))}))}),await Promise.all(a),s.Fo.vr(i),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>aa.forEach(t,t=>aa.forEach(t.$n,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>aa.forEach(t.On,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!da(e))throw e;Er("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.jn.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.jn=r.jn.insert(t,s)}}}(s.localStore,o))}async function mu(r,e){const s=r;if(vu(s),wu(s),!0===e&&!0!==s.zo){const r=s.sharedClientState.getAllActiveQueryTargets(),e=await pu(s,r.toArray());s.zo=!0,await Lc(s.remoteStore,!0);for(const r of e)wc(s.remoteStore,r)}else if(!1===e&&!1!==s.zo){const r=[];let n=Promise.resolve();s.Bo.forEach((e,t)=>{s.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(uu(s,t),Rh(s.localStore,t,!0))),bc(s.remoteStore,t)}),await n,await pu(s,r),function(){const n=s;n.Ko.forEach((e,t)=>{bc(n.remoteStore,t)}),n.jo.fs(),n.Ko=new Map,n.qo=new Bi(ds.comparator)}(),s.zo=!1,await Lc(s.remoteStore,!1)}}async function pu(t,n){const r=t,s=[],i=[];for(const t of n){let e;const u=r.Bo.get(t);if(u&&0!==u.length){e=await xh(r.localStore,ni(u[0]));for(const t of u){const n=r.Lo.get(t),u=(o=r,a=n,c=h=void 0,c=await Lh((h=o).localStore,a.query,!0),c=a.view.$o(c),h.isPrimaryClient&&du(h,a.targetId,c.ko),await c);u.snapshot&&i.push(u.snapshot)}}else{const u=await Oh(r.localStore,t);e=await xh(r.localStore,u),await ru(r,yu(u),t,!1)}s.push(e)}var o,a,h,c;return r.Fo.vr(i),s}function yu(e){return Hs(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function vu(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=iu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.Ko.get(t);if(r&&r.Mo)return Yi().add(r.key);{let e=Yi();const r=n.Bo.get(t);if(!r)return e;for(const t of r){const r=n.Lo.get(t);e=e.unionWith(r.view.vo)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Ko.get(t),i=s&&s.key;if(i){let e=new Bi(ds.comparator);e=e.insert(i,Ds.newNoDocument(i,Gr.min()));const n=Yi().add(i),s=new Ji(Gr.min(),new Map,new $i(Br),e,n);await iu(r,s),r.qo=r.qo.remove(i),r.Ko.delete(t),fu(r)}else await Rh(r.localStore,t,!1).then(()=>uu(r,t,n)).catch(eh)}).bind(null,t),t.Fo.vr=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.ao(e)&&(r=!0);s.ro=e}}r&&Gc(n)}).bind(null,t.eventManager),t.Fo.Jo=(function(e,t,n){const r=e,s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function wu(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=au.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return s.bn.lookupMutationBatch(t,r).next(e=>(Dr(null!==e),n=e.keys(),s.bn.removeMutationBatch(t,e))).next(()=>s.bn.performConsistencyCheck(t)).next(()=>s.zn.Sn(t,n))})}(r.localStore,t);cu(r,t,n),hu(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await gu(r,e)}catch(n){await eh(n)}}).bind(null,t),t}class bu{constructor(){this.synchronizeTabs=!1}async initialize(e){this.O=cc(e.databaseInfo.databaseId),this.sharedClientState=this.Xo(e),this.persistence=this.Zo(e),await this.persistence.start(),this.gcScheduler=this.tc(e),this.localStore=this.ec(e)}tc(e){return null}ec(e){return Ah(this.persistence,new _h,e.initialUser,this.O)}Zo(e){return new Kh(Gh.$s,this.O)}Xo(e){return new tc}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Tu extends bu{constructor(e,t,n){super(),this.nc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=dh(t);let r=Gr.min();return e.Wt({index:zo.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=Aa(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Wn=e})}(this.localStore),await this.nc.initialize(this,e),await wu(this.nc.syncEngine),await Nc(this.nc.remoteStore),await this.persistence.on(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}ec(e){return Ah(this.persistence,new _h,e.initialUser,this.O)}tc(e){var t=this.persistence.referenceDelegate.garbageCollector;return new rh(t,e.asyncQueue)}Zo(e){var t=bh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ba.withCacheSize(this.cacheSizeBytes):Ba.DEFAULT;return new yh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ac(),hc(),this.O,this.sharedClientState,!!this.forceOwnership)}Xo(e){return new tc}}class Eu extends Tu{constructor(e,t){super(e,t,!1),this.nc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.nc.syncEngine;this.sharedClientState instanceof ec&&(this.sharedClientState.syncEngine={yi:(async function(e,t,n,r){var s=e,i=await function(e,n){const r=e,s=r.bn;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.ee(t,n).next(e=>e?r.zn.Sn(t,e):aa.resolve(null)))}(s.localStore,t);null!==i?("pending"===n?await Nc(s.remoteStore):"acknowledged"===n||"rejected"===n?(cu(s,t,r||null),hu(s,t),s.localStore.bn.se(t)):Ar(),await gu(s,i)):Er("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),pi:(async function(e,t,n,r){const s=e;if(s.zo)Er("SyncEngine","Ignoring unexpected query state notification.");else if(s.Bo.has(t))switch(n){case"current":case"not-current":{const e=await Mh(s.localStore),r=Ji.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await gu(s,e,r);break}case"rejected":await Rh(s.localStore,t,!0),uu(s,t,r);break;default:Ar()}}).bind(null,t),Ti:(async function(e,t,n){const r=vu(e);if(r.zo){for(const e of t)if(r.Bo.has(e))Er("SyncEngine","Adding an already active target "+e);else{const t=await Oh(r.localStore,e),n=await xh(r.localStore,t);await ru(r,yu(t),n.targetId,!1),wc(r.remoteStore,n)}for(const e of n)r.Bo.has(e)&&await Rh(r.localStore,e,!1).then(()=>{bc(r.remoteStore,e),uu(r,e)}).catch(eh)}}).bind(null,t),In:(function(e){return e.localStore.persistence.In()}).bind(null,t),gi:(async function(e){const t=e;return Mh(t.localStore).then(e=>gu(t,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.on(async e=>{await mu(this.nc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Xo(e){var t=ac();if(!ec.Vt(t))throw new Nr(Cr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=bh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ec(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Iu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ou(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){Er("SyncEngine","User change. New user:",t.toKey());const r=await Dh(n.localStore,t);n.currentUser=t,(e=n).Wo.forEach(e=>{e.forEach(e=>{e.reject(new Nr(Cr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Wo.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await gu(n,r.Hn)}}).bind(null,this.syncEngine),await Lc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new jc}createDatastore(e){var t,n,r,s,i=cc(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new oc(t));return n=e.authCredentials,r=e.appCheckCredentials,s=t,e=i,new gc(n,r,s,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>ou(this.syncEngine,e,0),i=new(rc.Vt()?rc:nc),new pc(t,n,r,s,i);var t,n,r,s,i}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new nu(e,t,n,r,s,i);return o&&(a.zo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;Er("RemoteStore","RemoteStore shutting down."),t.Hr.add(5),await vc(t),t.Yr.shutdown(),t.Xr.set("Unknown")}(this.remoteStore)}}function _u(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Su{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.sc(this.observer.next,e)}error(e){this.observer.error?this.sc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}ic(){this.muted=!0}sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Au{constructor(e,t){this.rc=e,this.O=t,this.metadata=new kr,this.buffer=new Uint8Array,this.oc=new TextDecoder("utf-8"),this.cc().then(e=>{e&&e.yo()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.rc.cancel()}async getMetadata(){return this.metadata.promise}async Yo(){return await this.getMetadata(),this.cc()}async cc(){var e=await this.ac();if(null===e)return null;var t=this.oc.decode(e),n=Number(t);isNaN(n)&&this.uc(`length string (${t}) is not valid number`);t=await this.hc(n);return new Wc(JSON.parse(t),e.length+n)}lc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async ac(){for(;this.lc()<0&&!await this.fc(););if(0===this.buffer.length)return null;var e=this.lc();e<0&&this.uc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async hc(e){for(;this.buffer.length<e;)await this.fc()&&this.uc("Reached the end of bundle when more is expected.");var t=this.oc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}uc(e){throw this.rc.cancel(),new Error(`Invalid bundle format: ${e}`)}async fc(){var e=await this.rc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Du{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Nr(Cr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=bo(r.O)+"/documents",s={documents:t.map(e=>po(r.O,e))},i=await r.Wi("BatchGetDocuments",n,s),o=new Map;i.forEach(e=>{const t=(n=r.O,"found"in(e=e)?function(e,t){Dr(!!t.found),t.found.name,t.found.updateTime;var n=yo(e,t.found.name),r=fo(t.found.updateTime),s=new As({mapValue:{fields:t.found.fields}});return Ds.newFoundDocument(n,r,s)}(n,e):"missing"in e?function(e,t){Dr(!!t.missing),Dr(!!t.readTime);var n=yo(e,t.missing),r=fo(t.readTime);return Ds.newNoDocument(n,r)}(n,e):Ar());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{var t=o.get(e.toString());Dr(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Pi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=ds.fromPath(t);this.mutations.push(new Fi(n,this.precondition(n)))}),await async function(e,t){const n=e,r=bo(n.O)+"/documents",s={writes:t.map(e=>_o(n.O,e))};await n.qi("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ar();t=Gr.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Nr(Cr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?_i.updateTime(t):_i.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return _i.exists(!0);if(t.isEqual(Gr.min()))throw new Nr(Cr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _i.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Cu{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.dc=5,this.lr=new uc(this.asyncQueue,"transaction_retry")}run(){--this.dc,this.wc()}wc(){this.lr.er(async()=>{const t=new Du(this.datastore),e=this._c(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.mc(e)}))}).catch(e=>{this.mc(e)})})}_c(e){try{var t=this.updateFunction(e);return!cs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}mc(e){0<this.dc&&this.gc(e)?(--this.dc,this.asyncQueue.enqueueAndForget(()=>(this.wc(),Promise.resolve()))):this.deferred.reject(e)}gc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||!qi(t)}}class Nu{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=vr.UNAUTHENTICATED,this.clientId=Ur.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{Er("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(Er("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Nr(Cr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new kr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=Fc(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function ku(e,t){e.asyncQueue.verifyOperationInProgress(),Er("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Dh(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function xu(e,n){e.asyncQueue.verifyOperationInProgress();var t=await Ru(e);Er("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>Rc(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>Rc(n.remoteStore,t)),e.onlineComponents=n}async function Ru(e){return e.offlineComponents||(Er("FirestoreClient","Using default OfflineComponentProvider"),await ku(e,new bu)),e.offlineComponents}async function Lu(e){return e.onlineComponents||(Er("FirestoreClient","Using default OnlineComponentProvider"),await xu(e,new Iu)),e.onlineComponents}function Ou(e){return Ru(e).then(e=>e.persistence)}function Mu(e){return Ru(e).then(e=>e.localStore)}function Pu(e){return Lu(e).then(e=>e.remoteStore)}function Fu(e){return Lu(e).then(e=>e.syncEngine)}async function Vu(e){const t=await Lu(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=vu(e);let r,s;const i=n.Lo.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Oo();else{const e=await xh(n.localStore,ni(t)),i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await ru(n,t,r,"current"===i),n.isPrimaryClient&&wc(n.remoteStore,e)}return s}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.Lo.get(t),s=n.Bo.get(r.targetId);if(1<s.length)return n.Bo.set(r.targetId,s.filter(e=>!si(e,t))),void n.Lo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Rh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),bc(n.remoteStore,r.targetId),uu(n,r.targetId)}).catch(eh)):(uu(n,r.targetId),await Rh(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function qu(e,t,n={}){const r=new kr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,s,i,o){const e=new Su({next:e=>{r.enqueueAndForget(()=>$c(n,a));var t=e.docs.has(s);!t&&e.fromCache?o.reject(new Nr(Cr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&i&&"server"===i.source?o.reject(new Nr(Cr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new zc(Qs(s.path),e,{includeMetadataChanges:!0,mo:!0});return Kc(n,a)}(await Vu(e),e.asyncQueue,t,n,r)),r.promise}function Uu(e,t,n={}){const r=new kr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,s){const i=new Su({next:e=>{n.enqueueAndForget(()=>$c(t,o)),e.fromCache&&"server"===r.source?s.reject(new Nr(Cr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),o=new zc(e,i,{includeMetadataChanges:!0,mo:!0});return Kc(t,o)}(await Vu(e),e.asyncQueue,t,n,r)),r.promise}function Bu(e,t,n,r){const s=(n=n,t=cc(t),i="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return _u(e,void 0);if(e instanceof ArrayBuffer)return _u(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(i),t=t,new Au(n,t));var i;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var s=await n.getMetadata();if(await function(e,t){const n=e,r=fo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ze.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,s))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes});r._updateProgress(Yc(s));const o=new Qc(s,t.localStore,n.O);let e=await n.Yo();for(;e;){const t=await o.To(e);t&&r._updateProgress(t),e=await n.Yo()}var i=await o.complete();await gu(t,i.Rn,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ze.saveBundleMetadata(e,t))}(t.localStore,s),r._completeWith(i.progress)}catch(t){_r("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await Fu(e),s,r)})}const ju=new Map;function Ku(e,t,n){if(!n)throw new Nr(Cr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function $u(e,t,n,r){if(!0===t&&!0===r)throw new Nr(Cr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Gu(e){if(!ds.isDocumentKey(e))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function zu(e){if(ds.isDocumentKey(e))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Wu(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Ar();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function Hu(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new Nr(Cr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Wu(e);throw new Nr(Cr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function Qu(e,t){if(t<=0)throw new Nr(Cr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Yu{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Nr(Cr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Nr(Cr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,$u("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xu{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Yu({}),this._settingsFrozen=!1,e instanceof hs?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Nr(Cr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hs(e.options.projectId)}(e))}get app(){if(!this._app)throw new Nr(Cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Nr(Cr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Yu(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Rr;switch(e.type){case"gapi":var t=e.client;return Dr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Pr(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Nr(Cr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ju.get(e);t&&(Er("ComponentProvider","Removing Datastore"),ju.delete(e),t.terminate())}(this),Promise.resolve()}}function Ju(n,e,t,r={}){var s;const i=(n=Hu(n,Xu))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&_r("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=vr.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Nr(Cr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new vr(i)}n._authCredentials=new Lr(new xr(e,t))}}class Zu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Zu(this.firestore,e,this._key)}}class el{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new el(this.firestore,e,this._query)}}class tl extends el{constructor(e,t,n){super(e,t,Qs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Zu(this.firestore,null,new ds(e))}withConverter(e){return new tl(this.firestore,e,this._path)}}function nl(e,t,...n){if(e=m(e),Ku("collection","path",t),e instanceof Xu){var r=Yr.fromString(t,...n);return zu(r),new tl(e,null,r)}if(!(e instanceof Zu||e instanceof tl))throw new Nr(Cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Yr.fromString(t,...n));return zu(r),new tl(e.firestore,null,r)}function rl(e,t,...n){if(e=m(e),Ku("doc","path",t=1===arguments.length?Ur.A():t),e instanceof Xu){var r=Yr.fromString(t,...n);return Gu(r),new Zu(e,null,new ds(r))}if(!(e instanceof Zu||e instanceof tl))throw new Nr(Cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(Yr.fromString(t,...n));return Gu(r),new Zu(e.firestore,e instanceof tl?e.converter:null,new ds(r))}function sl(e,t){return e=m(e),t=m(t),(e instanceof Zu||e instanceof tl)&&(t instanceof Zu||t instanceof tl)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function il(e,t){return e=m(e),t=m(t),e instanceof el&&t instanceof el&&e.firestore===t.firestore&&si(e._query,t._query)&&e.converter===t.converter}class ol{constructor(){this.yc=Promise.resolve(),this.Tc=[],this.Ec=!1,this.Ic=[],this.Ac=null,this.Rc=!1,this.bc=!1,this.Pc=[],this.lr=new uc(this,"async_queue_retry"),this.vc=()=>{var e=hc();e&&Er("AsyncQueue","Visibility state changed to "+e.visibilityState),this.lr.sr()};const e=hc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.vc)}get isShuttingDown(){return this.Ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Vc(),this.Sc(e)}enterRestrictedMode(e){if(!this.Ec){this.Ec=!0,this.bc=e||!1;const t=hc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vc)}}enqueue(e){if(this.Vc(),this.Ec)return new Promise(()=>{});const t=new kr;return this.Sc(()=>this.Ec&&this.bc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Tc.push(e),this.Dc()))}async Dc(){if(0!==this.Tc.length){try{await this.Tc[0](),this.Tc.shift(),this.lr.reset()}catch(e){if(!da(e))throw e;Er("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Tc.length&&this.lr.er(()=>this.Dc())}}Sc(e){var t=this.yc.then(()=>(this.Rc=!0,e().catch(e=>{throw this.Ac=e,this.Rc=!1,Ir("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Rc=!1,e))));return this.yc=t}enqueueAfterDelay(e,t,n){this.Vc(),-1<this.Pc.indexOf(e)&&(t=0);var r=Pc.createAndSchedule(this,e,t,n,e=>this.Cc(e));return this.Ic.push(r),r}Vc(){this.Ac&&Ar()}verifyOperationInProgress(){}async Nc(){for(var e;await(e=this.yc),e!==this.yc;);}kc(e){for(const t of this.Ic)if(t.timerId===e)return!0;return!1}xc(t){return this.Nc().then(()=>{this.Ic.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Ic)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Nc()})}$c(e){this.Pc.push(e)}Cc(e){var t=this.Ic.indexOf(e);this.Ic.splice(t,1)}}function al(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class hl{constructor(){this._progressObserver={},this._taskCompletionResolver=new kr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var cl,ul,ll;class dl extends Xu{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new ol,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||gl(this),this._firestoreClient.terminate()}}function fl(e){return e._firestoreClient||gl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function gl(e){var t,n,r,s,i,o=e._freezeSettings(),o=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",s=e._persistenceKey,i=o,new as(n,r,s,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new Nu(e._authCredentials,e._appCheckCredentials,e._queue,o)}function ml(e,n,r){const s=new kr;return e.asyncQueue.enqueue(async()=>{try{await ku(e,r),await xu(e,n),s.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===Cr.FAILED_PRECONDITION||t.code===Cr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e)}var t}).then(()=>s.promise)}function pl(e){return function(e){const t=new kr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;Sc(n.remoteStore)||Er("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.bn.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Wo.get(e)||[];r.push(t),n.Wo.set(e,r)}catch(e){const n=Fc(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Fu(e),t)),t.promise}(fl(e=Hu(e,dl)))}function yl(e){return(n=fl(e=Hu(e,dl))).asyncQueue.enqueue(async()=>{const e=await Ou(n),t=await Pu(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Hr.delete(0),yc(e)}()});var n}function vl(e){return(n=fl(e=Hu(e,dl))).asyncQueue.enqueue(async()=>{const e=await Ou(n),t=await Pu(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Hr.add(0),await vc(e),e.Xr.set("Offline")}()});var n}function wl(t,e){return n=fl(t=Hu(t,dl)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ze.getNamedQuery(e,t))}(await Mu(n),r)).then(e=>e?new el(t,null,e.query):null);var n,r}function bl(e){if(e._initialized||e._terminated)throw new Nr(Cr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Tl{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Nr(Cr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class El{constructor(e){this._byteString=e}static fromBase64String(e){try{return new El(es.fromBase64String(e))}catch(e){throw new Nr(Cr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new El(es.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Il{constructor(e){this._methodName=e}}class _l{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new Nr(Cr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new Nr(Cr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Br(this._lat,e._lat)||Br(this._long,e._long)}}const Sl=/^__.*__$/;class Al{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ri(e,this.data,this.fieldMask,t,this.fieldTransforms):new xi(e,this.data,t,this.fieldTransforms)}}class Dl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ri(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Cl(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Ar()}}class Nl{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.O=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Oc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Mc(){return this.settings.Mc}Fc(e){return new Nl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Lc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fc({path:n,Bc:!1});return r.Uc(e),r}qc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fc({path:n,Bc:!1});return r.Oc(),r}Kc(e){return this.Fc({path:void 0,Bc:!0})}jc(e){return Ql(e,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Wc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Oc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Uc(this.path.get(e))}Uc(e){if(0===e.length)throw this.jc("Document fields must not be empty");if(Cl(this.Mc)&&Sl.test(e))throw this.jc('Document fields cannot begin and end with "__"')}}class kl{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.O=n||cc(e)}Gc(e,t,n,r=!1){return new Nl({Mc:e,methodName:t,Wc:n,path:Jr.emptyPath(),Bc:!1,Qc:r},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function xl(e){var t=e._freezeSettings(),n=cc(e._databaseId);return new kl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Rl(e,t,n,r,s,i={}){const o=e.Gc(i.merge||i.mergeFields?2:0,t,n,s);Gl("Data must be an object, but it was:",o,r);var a=Kl(r,o);let h,c;if(i.merge)h=new Zr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=zl(t,r,n);if(!o.contains(s))throw new Nr(Cr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Yl(e,s)||e.push(s)}h=new Zr(e),c=o.fieldTransforms.filter(e=>h.covers(e.field))}else h=null,c=o.fieldTransforms;return new Al(new As(a),h,c)}class Ll extends Il{_toFieldTransform(e){if(2!==e.Mc)throw 1===e.Mc?e.jc(`${this._methodName}() can only appear at the top level of your update data`):e.jc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ll}}function Ol(e,t,n){return new Nl({Mc:3,Wc:t.settings.Wc,methodName:e._methodName,Bc:n},t.databaseId,t.O,t.ignoreUndefinedProperties)}class Ml extends Il{_toFieldTransform(e){return new Ei(e.path,new gi)}isEqual(e){return e instanceof Ml}}class Pl extends Il{constructor(e,t){super(e),this.zc=t}_toFieldTransform(e){const t=Ol(this,e,!0),n=this.zc.map(e=>jl(e,t)),r=new mi(n);return new Ei(e.path,r)}isEqual(e){return this===e}}class Fl extends Il{constructor(e,t){super(e),this.zc=t}_toFieldTransform(e){const t=Ol(this,e,!0),n=this.zc.map(e=>jl(e,t)),r=new yi(n);return new Ei(e.path,r)}isEqual(e){return this===e}}class Vl extends Il{constructor(e,t){super(e),this.Hc=t}_toFieldTransform(e){var t=new wi(e.O,li(e.O,this.Hc));return new Ei(e.path,t)}isEqual(e){return this===e}}function ql(e,s,i,t){const o=e.Gc(1,s,i);Gl("Data must be an object, but it was:",o,t);const a=[],h=As.empty();Wr(t,(e,t)=>{var n=Hl(s,e,i);t=m(t);var r=o.qc(n);if(t instanceof Ll)a.push(n);else{const e=jl(t,r);null!=e&&(a.push(n),h.set(n,e))}});var n=new Zr(a);return new Dl(h,n,o.fieldTransforms)}function Ul(e,t,n,r,s,i){const o=e.Gc(1,t,n),a=[zl(t,r,n)],h=[s];if(i.length%2!=0)throw new Nr(Cr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(zl(t,i[f])),h.push(i[f+1]);const c=[],u=As.empty();for(let g=a.length-1;0<=g;--g)if(!Yl(c,a[g])){const t=a[g];var l=m(l=h[g]);const r=o.qc(t);if(l instanceof Ll)c.push(t);else{const e=jl(l,r);null!=e&&(c.push(t),u.set(t,e))}}var d=new Zr(c);return new Dl(u,d,o.fieldTransforms)}function Bl(e,t,n,r=!1){return jl(n,e.Gc(r?4:3,t))}function jl(i,e){if($l(i=m(i)))return Gl("Unsupported field value:",e,i),Kl(i,e);if(i instanceof Il)return function(e,t){if(!Cl(t.Mc))throw t.jc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.jc(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(i,e),null;if(void 0===i&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.Bc&&4!==e.Mc)throw e.jc("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const s of i){let e=jl(s,t.Kc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=m(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return li(t.O,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=$r.fromDate(e);return{timestampValue:uo(t.O,n)}}if(e instanceof $r){n=new $r(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:uo(t.O,n)}}if(e instanceof _l)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof El)return{bytesValue:lo(t.O,e._byteString)};if(e instanceof Zu){const r=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(r))throw t.jc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:go(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.jc(`Unsupported field value: ${Wu(e)}`)}(0,e)}function Kl(e,r){const s={};return Hr(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Wr(e,(e,t)=>{var n=jl(t,r.Lc(e));null!=n&&(s[e]=n)}),{mapValue:{fields:s}}}function $l(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof $r||e instanceof _l||e instanceof El||e instanceof Zu||e instanceof Il)}function Gl(e,t,n){if(!$l(n)||("object"!=typeof(s=n)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s))){var r=Wu(n);throw"an object"===r?t.jc(e+" a custom object"):t.jc(e+" "+r)}var s}function zl(e,t,n){if((t=m(t))instanceof Tl)return t._internalPath;if("string"==typeof t)return Hl(e,t);throw Ql("Field path arguments must be of type string or ",e,!1,void 0,n)}const Wl=new RegExp("[~\\*/\\[\\]]");function Hl(t,n,r){if(0<=n.search(Wl))throw Ql(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new Tl(...n.split("."))._internalPath}catch(e){throw Ql(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Ql(e,t,n,r,s){var i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${r}`),o&&(h+=` in document ${s}`),h+=")"),new Nr(Cr.INVALID_ARGUMENT,a+e+h)}function Yl(e,t){return e.some(e=>e.isEqual(t))}class Xl{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Zu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new Jl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(Zl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Jl extends Xl{data(){return super.data()}}function Zl(e,t){return"string"==typeof t?Hl(e,t):(t instanceof Tl?t:t._delegate)._internalPath}class ed{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class td extends Xl{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new nd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(Zl("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class nd extends td{data(e={}){return super.data(e)}}class rd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ed(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new nd(this._firestore,this._userDataWriter,e.key,e,new ed(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Nr(Cr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){let t=0;return i._snapshot.docChanges.map(e=>({type:"added",doc:new nd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new ed(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:t++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new nd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new ed(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(s=s.add(e.doc),r=s.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ar()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function sd(e,t){return e instanceof td&&t instanceof td?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof rd&&t instanceof rd&&e._firestore===t._firestore&&il(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function id(e){if(Xs(e)&&0===e.explicitOrderBy.length)throw new Nr(Cr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class od{}function ad(e,...t){for(const n of t)e=n._apply(e);return e}class hd extends od{constructor(e,t,n){super(),this.Jc=e,this.Yc=t,this.Xc=n,this.type="where"}_apply(e){var t=xl(e.firestore),t=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Nr(Cr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){md(o,i);const t=[];for(const n of o)t.push(gd(r,e,n));a={arrayValue:{values:t}}}else a=gd(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||md(o,i),a=Bl(n,t,o,"in"===i||"not-in"===i);var h=Ls.create(s,i,a);return function(e,t){if(t.D()){const r=Zs(e);if(null!==r&&!r.isEqual(t.field))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=Js(e);null!==n&&pd(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new Nr(Cr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Nr(Cr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,h),h}(e._query,"where",t,e.firestore._databaseId,this.Jc,this.Yc,this.Xc);return new el(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new Ws(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class cd extends od{constructor(e,t){super(),this.Jc=e,this.Zc=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new Nr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Nr(Cr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,s=new $s(t,n);return n=s,null!==Js(e=e)||null!==(r=Zs(e))&&pd(0,r,n.field),s}(e._query,this.Jc,this.Zc);return new el(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new Ws(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class ud extends od{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){return new el(e.firestore,e.converter,ri(e._query,this.ta,this.ea))}}class ld extends od{constructor(e,t,n){super(),this.type=e,this.na=t,this.sa=n}_apply(e){var t,n=fd(e,this.type,this.na,this.sa);return new el(e.firestore,e.converter,(t=e._query,e=n,new Ws(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class dd extends od{constructor(e,t,n){super(),this.type=e,this.na=t,this.sa=n}_apply(e){var t,n=fd(e,this.type,this.na,this.sa);return new el(e.firestore,e.converter,(t=e._query,e=n,new Ws(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function fd(e,t,n,r){if(n[0]=m(n[0]),n[0]instanceof Xl)return function(e,t,n,r,s){if(!r)throw new Nr(Cr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of ti(e))if(n.field.isKeyField())i.push(ws(t,r.key));else{const e=r.data.field(n.field);if(is(e))throw new Nr(Cr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new js(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var s=xl(e.firestore);return function(e,t,n,r,s,i){const o=e.explicitOrderBy;if(s.length>o.length)throw new Nr(Cr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let h=0;h<s.length;h++){const c=s[h];if(o[h].field.isKeyField()){if("string"!=typeof c)throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!ei(e)&&-1!==c.indexOf("/"))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(Yr.fromString(c));if(!ds.isDocumentKey(n))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new ds(n);a.push(ws(t,s))}else{const e=Bl(n,r,c);a.push(e)}}return new js(a,i)}(e._query,e.firestore._databaseId,s,t,n,r)}function gd(e,t,n){if("string"==typeof(n=m(n))){if(""===n)throw new Nr(Cr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ei(t)&&-1!==n.indexOf("/"))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(Yr.fromString(n));if(!ds.isDocumentKey(r))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ws(e,new ds(r))}if(n instanceof Zu)return ws(e,n._key);throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wu(n)}.`)}function md(e,t){if(!Array.isArray(e)||0===e.length)throw new Nr(Cr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new Nr(Cr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function pd(e,t,n){if(!n.isEqual(t))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class yd{convertValue(e,t="none"){switch(fs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ss(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ar()}}convertObject(e,n){const r={};return Wr(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new _l(rs(e.latitude),rs(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return is(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(os(e));default:return null}}convertTimestamp(e){var t=ns(e);return new $r(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Yr.fromString(e);Dr(Mo(n));const r=new hs(n.get(1),n.get(3)),s=new ds(n.popFirst(5));return r.isEqual(t)||Ir(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function vd(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class wd extends yd{constructor(e){super(),this.firestore=e}convertBytes(e){return new El(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zu(this.firestore,null,t)}}class bd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xl(e)}set(e,t,n){this._verifyNotCommitted();const r=Td(e,this._firestore),s=vd(r.converter,t,n),i=Rl(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,_i.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var s=Td(e,this._firestore);let i;return i="string"==typeof(t=m(t))||t instanceof Tl?Ul(this._dataReader,"WriteBatch.update",s._key,t,n,r):ql(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,_i.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Td(e,this._firestore);return this._mutations=this._mutations.concat(new Pi(t._key,_i.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Nr(Cr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Td(e,t){if((e=m(e)).firestore!==t)throw new Nr(Cr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Ed extends yd{constructor(e){super(),this.firestore=e}convertBytes(e){return new El(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zu(this.firestore,null,t)}}function Id(t){t=Hu(t,Zu);const n=Hu(t.firestore,dl),e=fl(n),r=new Ed(n);return function(e,t){const n=new kr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const s=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.zn.Pn(e,t))}(t);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new Nr(Cr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=Fc(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Mu(e),t,n)),n.promise}(e,t._key).then(e=>new td(n,r,t._key,e,new ed(null!==e&&e.hasLocalMutations,!0),t.converter))}function _d(t){t=Hu(t,el);const n=Hu(t.firestore,dl),e=fl(n),r=new Ed(n);return function(e,t){const n=new kr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const s=await Lh(e,t,!0),i=new Zc(t,s.Jn),o=i.Vo(s.documents),a=i.applyChanges(o,!1);n.resolve(a.snapshot)}catch(e){var r=Fc(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Mu(e),t,n)),n.promise}(e,t._query).then(e=>new rd(n,r,t,e))}function Sd(e,t,n){e=Hu(e,Zu);var r=Hu(e.firestore,dl),s=vd(e.converter,t,n);return Nd(r,[Rl(xl(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,_i.none())])}function Ad(e,t,n,...r){e=Hu(e,Zu);var s=Hu(e.firestore,dl),i=xl(s);let o;return o="string"==typeof(t=m(t))||t instanceof Tl?Ul(i,"updateDoc",e._key,t,n,r):ql(i,"updateDoc",e._key,t),Nd(s,[o.toMutation(e._key,_i.exists(!0))])}function Dd(t,...n){var e;t=m(t);let r={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||al(n[s])||(r=n[s],s++);var i={includeMetadataChanges:r.includeMetadataChanges};if(al(n[s])){const t=n[s];n[s]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[s+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[s+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,h;if(t instanceof Zu)a=Hu(t.firestore,dl),h=Qs(t._key.path),o={next:e=>{n[s]&&n[s](kd(a,t,e))},error:n[s+1],complete:n[s+2]};else{const c=Hu(t,el);a=Hu(c.firestore,dl),h=c._query;const u=new Ed(a);o={next:e=>{n[s]&&n[s](new rd(a,u,c,e))},error:n[s+1],complete:n[s+2]},id(t._query)}return function(e,t,n,r){const s=new Su(r),i=new zc(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>Kc(await Vu(e),i)),()=>{s.ic(),e.asyncQueue.enqueueAndForget(async()=>$c(await Vu(e),i))}}(fl(a),h,i,o)}function Cd(e,t){return function(e,t){const n=new Su(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.oo.add(t),t.next()}(await Vu(e),n)),()=>{n.ic(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.oo.delete(t)}(await Vu(e),n))}}(fl(e=Hu(e,dl)),al(t)?t:{next:t})}function Nd(e,t){return function(e,t){const n=new kr;return e.asyncQueue.enqueueAndForget(async()=>su(await Fu(e),t,n)),n.promise}(fl(e),t)}function kd(e,t,n){var r=n.docs.get(t._key),s=new Ed(e);return new td(e,s,t._key,r,new ed(n.hasPendingWrites,n.fromCache),t.converter)}class xd extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=xl(e)}get(e){const n=Td(e,this._firestore),r=new wd(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return Ar();const t=e[0];if(t.isFoundDocument())return new Xl(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Xl(this._firestore,r,n._key,null,n.converter);throw Ar()})}set(e,t,n){var r=Td(e,this._firestore),s=vd(r.converter,t,n),s=Rl(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){var s=Td(e,this._firestore),i="string"==typeof(t=m(t))||t instanceof Tl?Ul(this._dataReader,"Transaction.update",s._key,t,n,r):ql(this._dataReader,"Transaction.update",s._key,t);return this._transaction.update(s._key,i),this}delete(e){var t=Td(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Td(e,this._firestore),n=new Ed(this._firestore);return super.get(e).then(e=>new td(this._firestore,n,t._key,e._document,new ed(!1,!1),t.converter))}}function Rd(t,n){return function(t,n){const r=new kr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await Lu(t).then(e=>e.datastore);new Cu(t.asyncQueue,e,n,r).run()}),r.promise}(fl(t=Hu(t,dl)),e=>n(new xd(t,e)))}cl=of.SDK_VERSION,wr=cl,of._registerComponent(new c("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new dl(n,new Or(e.getProvider("auth-internal")),new Vr(e.getProvider("app-check-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),of.registerVersion(yr,"3.4.4",void 0),of.registerVersion(yr,"3.4.4","esm2017");function Ld(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Nr("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Od(){if("undefined"==typeof Uint8Array)throw new Nr("unimplemented","Uint8Arrays are not available in this environment.")}function Md(){if("undefined"==typeof atob)throw new Nr("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Pd{constructor(e){this._delegate=e}static fromBase64String(e){return Md(),new Pd(El.fromBase64String(e))}static fromUint8Array(e){return Od(),new Pd(El.fromUint8Array(e))}toBase64(){return Md(),this._delegate.toBase64()}toUint8Array(){return Od(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Fd(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class Vd{enableIndexedDbPersistence(e,t){return function(e,t){bl(e=Hu(e,dl));var n=fl(e),r=e._freezeSettings(),s=new Iu;return ml(n,s,new Tu(s,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){bl(e=Hu(e,dl));var t=fl(e),n=e._freezeSettings(),r=new Iu;return ml(t,r,new Eu(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Nr(Cr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new kr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!ca.Vt())return Promise.resolve();var t=e+"main";await ca.delete(t)}(bh(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class qd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof hs||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||_r("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Ju(this._delegate,e,t,n)}enableNetwork(){return yl(this._delegate)}disableNetwork(){return vl(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,$u("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return pl(this._delegate)}onSnapshotsInSync(e){return Cd(this._delegate,e)}get app(){if(!this._appCompat)throw new Nr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Zd(this,nl(this._delegate,e))}catch(e){throw Gd(e,"collection()","Firestore.collection()")}}doc(e){try{return new $d(this,rl(this._delegate,e))}catch(e){throw Gd(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Yd(this,function(e,t){if(e=Hu(e,Xu),Ku("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new Nr(Cr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new el(e,null,(t=t,new Ws(Yr.emptyPath(),t)))}(this._delegate,e))}catch(e){throw Gd(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Rd(this._delegate,e=>t(new Bd(this,e)))}batch(){return fl(this._delegate),new jd(new bd(this._delegate,e=>Nd(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=fl(t=Hu(t,dl)),r=new hl,Bu(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return wl(this._delegate,e).then(e=>e?new Yd(this,e):null)}}class Ud extends yd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pd(new El(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return $d.forKey(t,this.firestore,null)}}class Bd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ud(e)}get(e){const t=ef(e);return this._delegate.get(t).then(e=>new Hd(this._firestore,new td(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=ef(e);return n?(Ld("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var s=ef(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){var t=ef(e);return this._delegate.delete(t),this}}class jd{constructor(e){this._delegate=e}set(e,t,n){var r=ef(e);return n?(Ld("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var s=ef(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,n,...r),this}delete(e){var t=ef(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Kd{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new nd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Qd(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Kd.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new Kd(e,new Ud(e),t),r.set(t,s)),s}}Kd.INSTANCES=new WeakMap;class $d{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ud(e)}static forPath(e,t,n){if(e.length%2!=0)throw new Nr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new $d(t,new Zu(t._delegate,n,new ds(e)))}static forKey(e,t,n){return new $d(t,new Zu(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Zd(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Zd(this.firestore,nl(this._delegate,e))}catch(e){throw Gd(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=m(e))instanceof Zu&&sl(this._delegate,e)}set(e,t){t=Ld("DocumentReference.set",t);try{return t?Sd(this._delegate,e,t):Sd(this._delegate,e)}catch(e){throw Gd(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Ad(this._delegate,e):Ad(this._delegate,e,t,...n)}catch(e){throw Gd(e,"updateDoc()","DocumentReference.update()")}}delete(){return Nd(Hu((e=this._delegate).firestore,dl),[new Pi(e._key,_i.none())]);var e}onSnapshot(...e){var t=zd(e),n=Wd(e,e=>new Hd(this.firestore,new td(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Dd(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?Id:"server"===(null==e?void 0:e.source)?function(t){t=Hu(t,Zu);const n=Hu(t.firestore,dl);return qu(fl(n),t._key,{source:"server"}).then(e=>kd(n,t,e))}:function(t){t=Hu(t,Zu);const n=Hu(t.firestore,dl);return qu(fl(n),t._key).then(e=>kd(n,t,e))})(this._delegate),t.then(e=>new Hd(this.firestore,new td(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new $d(this.firestore,e?this._delegate.withConverter(Kd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Gd(e,t,n){return e.message=e.message.replace(t,n),e}function zd(e){for(const t of e)if("object"==typeof t&&!Fd(t))return t;return{}}function Wd(e,t){var n;let r;return r=Fd(e[0])?e[0]:Fd(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class Hd{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new $d(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return sd(this._delegate,e._delegate)}}class Qd extends Hd{data(e){var t=this._delegate.data(e);return void 0!==t||Ar(),t}}class Yd{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ud(e)}where(e,t,n){try{return new Yd(this.firestore,ad(this._delegate,(r=n,s=t,i=Zl("where",e),new hd(i,s,r))))}catch(e){throw Gd(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(e,t){try{return new Yd(this.firestore,ad(this._delegate,([n,r="asc"]=[e,t],s=r,i=Zl("orderBy",n),new cd(i,s))))}catch(e){throw Gd(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,s,i}limit(e){try{return new Yd(this.firestore,ad(this._delegate,(Qu("limit",t=e),new ud("limit",t,"F"))))}catch(e){throw Gd(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Yd(this.firestore,ad(this._delegate,(Qu("limitToLast",t=e),new ud("limitToLast",t,"L"))))}catch(e){throw Gd(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Yd(this.firestore,ad(this._delegate,function(...e){return new ld("startAt",e,!0)}(...e)))}catch(e){throw Gd(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Yd(this.firestore,ad(this._delegate,function(...e){return new ld("startAfter",e,!1)}(...e)))}catch(e){throw Gd(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Yd(this.firestore,ad(this._delegate,function(...e){return new dd("endBefore",e,!0)}(...e)))}catch(e){throw Gd(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Yd(this.firestore,ad(this._delegate,function(...e){return new dd("endAt",e,!1)}(...e)))}catch(e){throw Gd(e,"endAt()","Query.endAt()")}}isEqual(e){return il(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?_d:"server"===(null==e?void 0:e.source)?function(t){t=Hu(t,el);const n=Hu(t.firestore,dl),e=fl(n),r=new Ed(n);return Uu(e,t._query,{source:"server"}).then(e=>new rd(n,r,t,e))}:function(t){t=Hu(t,el);const n=Hu(t.firestore,dl),e=fl(n),r=new Ed(n);return id(t._query),Uu(e,t._query).then(e=>new rd(n,r,t,e))})(this._delegate),t.then(e=>new Jd(this.firestore,new rd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=zd(e),n=Wd(e,e=>new Jd(this.firestore,new rd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Dd(this._delegate,t,n)}withConverter(e){return new Yd(this.firestore,e?this._delegate.withConverter(Kd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Xd{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Qd(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Jd{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Yd(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Qd(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Xd(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new Qd(this._firestore,e))})}isEqual(e){return sd(this._delegate,e._delegate)}}class Zd extends Yd{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new $d(this.firestore,e):null}doc(e){try{return void 0===e?new $d(this.firestore,rl(this._delegate)):new $d(this.firestore,rl(this._delegate,e))}catch(e){throw Gd(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Hu(e.firestore,dl),r=rl(e),s=vd(e.converter,t);return Nd(n,[Rl(xl(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,_i.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new $d(this.firestore,e))}isEqual(e){return sl(this._delegate,e._delegate)}withConverter(e){return new Zd(this.firestore,e?this._delegate.withConverter(Kd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function ef(e){return Hu(e,Zu)}const tf={Firestore:qd,GeoPoint:_l,Timestamp:$r,Blob:Pd,Transaction:Bd,WriteBatch:jd,DocumentReference:$d,DocumentSnapshot:Hd,Query:Yd,QueryDocumentSnapshot:Qd,QuerySnapshot:Jd,CollectionReference:Zd,FieldPath:class nf{constructor(...e){this._delegate=new Tl(...e)}static documentId(){return new nf(Jr.keyField().canonicalString())}isEqual(e){return(e=m(e))instanceof Tl&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class rf{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Ml("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new rf(e)}static delete(){const e=new Ll("deleteField");return e._methodName="FieldValue.delete",new rf(e)}static arrayUnion(...e){const t=function(...e){return new Pl("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new rf(t)}static arrayRemove(...e){const t=function(...e){return new Fl("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new rf(t)}static increment(e){const t=new Vl("increment",e);return t._methodName="FieldValue.increment",new rf(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,br.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};ul=t.default,ll=(e,t)=>new qd(e,t,new Vd),ul.INTERNAL.registerComponent(new c("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return ll(t,n)},"PUBLIC").setServiceProps(Object.assign({},tf))),ul.registerVersion("@firebase/firestore-compat","0.1.13")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore-compat.js.map
